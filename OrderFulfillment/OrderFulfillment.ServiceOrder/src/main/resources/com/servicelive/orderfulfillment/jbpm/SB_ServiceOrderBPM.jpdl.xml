<?xml version="1.0" encoding="UTF-8"?>  

<process name="SB_ServiceOrderBPM" xmlns="http://jbpm.org/4.0/jpdl">

    <on event="start">
        <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy" propagation="enabled">
            <field name="commandList"><string value="TracingCmd();updateServiceDateProcessVariableCmd();"/></field>
        </event-listener>
    </on>
    <on event="end">
         <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
            <field name="commandList"><string value="MarkOrderProcessFinished()"/></field>
        </event-listener>
    </on>

    <start g="14,23,48,48" name="start">
        <transition g="-28,-7" name="SaveDraft" to="PreDraftCheck"/>
    </start>

    <state name="PreDraft">
        <transition g="207,38:-24,-20" name="EDIT_ORDER" to="PreDraftCheck"/>
    </state>

    <decision g="116,52,48,48" name="PreDraftCheck">
        <handler expr="#{serviceOrderDraftStateCheck}" />
        <transition g="23,45:-23,50" name="wait" to="PreDraft" />
        <transition g="142,145:-24,-20" name="forward" to="CreateDocumentActivity" />
    </decision>

    <custom name="CreateDocumentActivity" class="com.servicelive.orderfulfillment.node.DefaultCustomActivity">
        <transition to="AutoRoutePrepActivity">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SaveBuyerDocumentsCmd();"/></field>
            </event-listener>
        </transition>
    </custom>

    <custom name="AutoRoutePrepActivity" class="com.servicelive.orderfulfillment.node.DefaultCustomActivity">
    	<transition to="ProcessingPathCheck">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SetAutoRoutingBehaviorCmd();"/></field>
            </event-listener>
        </transition>
    </custom>

    <decision g="118,170,48,48" name="ProcessingPathCheck">
        <handler expr="#{autoRouteEligibilityCheck}" />
    	<transition g="-45,-54" name="WaitInDraftForMoreInformation" to="Draft">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="UpdateLegacyStatusCmd(START,DRAFT);UpdateSubStatusCmd(MISSING_INFORMATION);BuyerOutboundNotificationCmd(STATUS_CHANGE);DecreaseSpendingCmdFromPostToDraft();"/></field>
            </event-listener>
    	</transition>
    	<!-- SL 15642 Start Changes to have Car feature check first -->
        <transition g="-57,-20" name="ProceedToPost" to="ConditionalRouteFeatureOn">
        <!-- SL 15642 End Changes to have Car feature check first -->
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
            <field name="commandList"><string value="UpdateLegacyStatusCmd(START,DRAFT);BuyerOutboundNotificationCmd(STATUS_CHANGE);"/></field>
            </event-listener>
        </transition>
    	<transition g="-71,-20" name="WaitInDraft" to="Draft">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="UpdateLegacyStatusCmd(START,DRAFT);BuyerOutboundNotificationCmd(STATUS_CHANGE);"/></field>
            </event-listener>
    	</transition>
    	<transition g="-71,-20" name="WaitInDraftForRepeatRepair" to="Draft">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="UpdateLegacyStatusCmd(START,DRAFT);UpdateSubStatusCmd(REPEAT_REPAIR);BuyerOutboundNotificationCmd(STATUS_CHANGE);SONoteCommand(RepeatRepair);DecreaseSpendingCmdFromPostToDraft()"/></field>
            </event-listener>
    	</transition>    	
    	<transition g="-71,-20" name="WaitInDraftAndAutoRouteTimer" to="AutoRouteTimerState">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="UpdateLegacyStatusCmd(START,DRAFT);BuyerOutboundNotificationCmd(STATUS_CHANGE);setRouteDateProcessVariableCmd();"/></field>
            </event-listener>
    	</transition>
    	<transition g="-45,-54" name="WaitInDraftForValidJobcodes" to="Draft">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="UpdateLegacyStatusCmd(START,DRAFT);UpdateSubStatusCmd(JOBCODE_MISMATCH);BuyerOutboundNotificationCmd(STATUS_CHANGE);"/></field>
            </event-listener>
    	</transition>	
        <transition g="-45,-54" name="evaluateProviderForRecallOrder" to="evaluateRecallOrder">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="UpdateLegacyStatusCmd(START,DRAFT);BuyerOutboundNotificationCmd(STATUS_CHANGE);"/></field>
            </event-listener>
    	</transition>	
     </decision>
     <decision name="evaluateRecallOrder">
	       <handler expr="#{evaluateRecallOrder}" />
	             <transition name="hasProviders" to="evalProviderForInhomeAutoAcceptance">
	                 <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                       <field name="commandList"><string value="SetProvidersForInHomeAutoAccept();SOLoggingCmd(createWarrantyDraftSOLogging);"/></field>
                     </event-listener>
	             </transition>
	             <transition name="carRoute" to="ConditionalRouteFeatureOn">
	                 <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                       <field name="commandList"><string value="SONoteCommand(repeatRepairNote);"/></field>
                     </event-listener>
	             </transition>
 		         <transition name="noProviders" to="Draft">
		           <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy" propagation="enabled">
				        <field  name="commandList">
							 <string value="UpdateSubStatusCmd(REPEAT_REPAIR_NO_PROVIDER);SONoteCommand(repeatRepairNote);SOLoggingCmd(createWarrantyDraftSOLogging);DecreaseSpendingCmdFromPostToDraft();"/>
					    </field>
		           </event-listener>
	             </transition> 
	             <transition name="originalOrderNotExist" to="Draft">
		           <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy" propagation="enabled">
				        <field  name="commandList">
							 <string value="UpdateSubStatusCmd(REPEAT_REPAIR_NO_PROVIDER);SONoteCommand(repeatRepairNote);DecreaseSpendingCmdFromPostToDraft();"/>
					    </field>
		           </event-listener>
	             </transition> 
	             <transition g="-71,-20" name="WaitInDraftForRepeatRepair" to="Draft">
                       <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                            <field name="commandList"><string value="UpdateLegacyStatusCmd(START,DRAFT);UpdateSubStatusCmd(REPEAT_REPAIR);SONoteCommand(RepeatRepair);DecreaseSpendingCmdFromPostToDraft()"/></field>
                       </event-listener>
    	         </transition>    
	 </decision>
     <!-- Non W2 Priority 2: Checking the eligibility of provider of the original in home order Start-->
	    <decision name="evalProviderForInhomeAutoAcceptance">
	      <handler expr="${evalProviderForInhomeAutoAcceptance}"></handler>
	          <transition name="YES" to="Accepted">
	               <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy" propagation="enabled">
			            <field  name="commandList">
			                 <string value="DisableTierRouteCmd();SOLoggingRouteCmd(routeToProvidersLogging);UpdateLegacyStatusCmd(POSTED,ACCEPTED);BuyerOutboundNotificationCmd(POSTED);BuyerOutboundNotificationCmd(STATUS_CHANGE);
			                                GetWalletPostInfoCmd();UpdateSoHdrOnInhomeAutoAccept();AlertCmd(emailForBuyerPostReceipt);UpdateOrderAcceptAttributeCmd(AUTOMATIC);
			                                SpendLimitChangeCmd();SOLoggingCmd(inHomeAutoAcceptUpdateLogging);CheckAndSendAlertCmd(emailForRoutedSO,smsForRoutedSO);"></string>
			            </field>
		           </event-listener>
		        </transition>
		        <transition name="NO" to="Draft">
			           <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy" propagation="enabled">
					        <field  name="commandList">
								 <string value="UpdateSubStatusCmd(REPEAT_REPAIR_NO_PROVIDER);SONoteCommand(repeatRepairNote);DecreaseSpendingCmdFromPostToDraft();"/>
						    </field>
			           </event-listener>
		        </transition>
	</decision>
    <!-- Non W2 Priority 2: Checking the eligibility of provider of the original in home order End   -->
    <end g="398,46,48,48" name="Deleted">
	    <on event="start">
	        <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
	            <field name="commandList">
	                <string value="FireEventCmd(DELETED)"/>
	            </field>
	        </event-listener>
	    </on>
	</end>

	<decision name="MajorChangesCheckInDraft">
		<handler expr="#{majorChangesCheck}" />
		<transition name="skillCategoryChanged" to="CreateDocumentActivity" />
		<transition name="otherMajorChanges" to="AutoRoutePrepActivity">
			<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="ResetAutoTierRoutingTimeCmd()"/></field>
            </event-listener>
        </transition>
		<transition name="noMajorChanges" to="Draft"/>
	</decision>
<!-- Signals added in Draft state must also be included in AutoRouteTimerState state-->
    <state g="286,179,92,52" name="Draft">
        <on event="start">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="FireEventCmd(DRAFT);RemoveFieldsCmd(ServiceOrderChanges);"/>
                </field>
            </event-listener>
        </on>
        <transition g="-28,-18" name="POST_ORDER" to="AutoRoutingBehaviorCheckForPost"/>
        <transition g="-30,-20" name="AUTO_POST_ORDER" to="ProcessingPathCheck" />
        <transition g="404,158:2,-12" name="EDIT_ORDER" to="Draft"/>        
        <transition g="1450,506:-68,-14" name="UPDATE_ORDER" to="Draft"/> 
        <transition g="627,644:-24,-20" name="EDIT_SCHEDULE" to="Draft">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SOLoggingCmd(updateSOServiceDates);"/></field>
            </event-listener>
        </transition>
        <transition g="404,158:2,-12" name="UPDATE_BATCH_ORDER" to="MajorChangesCheckInDraft"/>
        <transition g="404,158:2,-12" name="ASN_UPDATE_BATCH_ORDER" to="Draft">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SONoteCommand(WSUpdate);"/></field>
            </event-listener>
        </transition>
        <transition g="403,21:2,1" name="ACKNOWLEDGE_BATCH_UPDATE" to="Draft">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SEARSHSR_SONoteCommand(HSRUpdate);UpdateSubStatusCmd(NEEDS_ATTENTION)"/></field>
            </event-listener>            
        </transition>
        <transition g="-11,-21" name="CANCEL_ORDER" to="Deleted">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                 <field name="commandList"><string value="UpdateLegacyStatusCmd(DRAFT,DELETED);BuyerOutboundNotificationCmd(STATUS_CHANGE);AutoCancelCmd();"/></field>
            </event-listener>
        </transition>
        <transition g="-11,-21" name="SL_CANCEL_ORDER" to="Deleted">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="UpdateLegacyStatusCmd(DRAFT,DELETED);BuyerOutboundNotificationCmd(STATUS_CHANGE);UpdateSOCancellationCmd(CANCEL);SOLoggingCmd(deleteDraftSO);RelayOutboundNotificationCmd(ORDER_CANCELED_BY_CUSTOMER);"/></field>
            </event-listener>
        </transition>
        <transition g="-11,-21" name="INTEGRATION_CANCEL_ORDER" to="Deleted">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SEARSHSR_SONoteCommand(HSRCancel,NEW_STATUS:Deleted);UpdateLegacyStatusCmd(DRAFT,DELETED);BuyerOutboundNotificationCmd(STATUS_CHANGE);SEARSRI_SONoteCommand(WSCancelled,DRAFT,DELETED);SOLoggingCmd(cancellingOrder,DRAFT,DELETED);AutoCancelCmd();"/></field>
            </event-listener>
        </transition>
        <transition g="-11,-21" name="INTEGRATION_CANCEL" to="Deleted" >
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="ASN_CreateInvoiceforAssurantCancelCmd();UpdateLegacyStatusCmd(DRAFT,DELETED);BuyerOutboundNotificationCmd(STATUS_CHANGE);ASN_SONoteCommand(WSCancel);AutoCancelCmd();"/></field>
            </event-listener>
        </transition>
        <transition g="-11,-21" name="NO_FEE_CANCEL_ORDER" to="Deleted">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="UpdateLegacyStatusCmd(DRAFT,DELETED);BuyerOutboundNotificationCmd(STATUS_CHANGE);AutoCancelCmd();"/></field>
            </event-listener>
        </transition>
		<transition g="627,644:-24,-20" name="SPEND_LIMIT_CHANGED" to="routingBehaviorCheckForSpendLimitChanged"/>
    </state>
    
    <!-- Signals added in Draft state must also be included in AutoRouteTimerState state with the same 'to' transition-->
    <state g="286,179,92,52" name="AutoRouteTimerState">
        <on event="start">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="FireEventCmd(DRAFT);RemoveFieldsCmd(ServiceOrderChanges);"/>
                </field>
            </event-listener>
        </on>
        <transition g="-33,-5" name="AutoRouteTimer" to="IsManualReviewNeeded">
    			<timer duedate="#{routeDate}" />
    	</transition>       
        <transition g="-28,-18" name="POST_ORDER" to="AutoRoutingBehaviorCheckForPost"/>
        <transition g="-30,-20" name="AUTO_POST_ORDER" to="ProcessingPathCheck" />
        <transition g="1450,506:-68,-14" name="UPDATE_ORDER" to="Draft"/> 
        <transition g="404,158:2,-12" name="EDIT_ORDER" to="Draft"/>
        <transition g="627,644:-24,-20" name="EDIT_SCHEDULE" to="Draft"/>
        <transition g="404,158:2,-12" name="UPDATE_BATCH_ORDER" to="MajorChangesCheckInDraft"/>
        <transition g="404,158:2,-12" name="ASN_UPDATE_BATCH_ORDER" to="Draft">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SONoteCommand(WSUpdate);"/></field>
            </event-listener>
        </transition>
        <transition g="403,21:2,1" name="ACKNOWLEDGE_BATCH_UPDATE" to="Draft">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SEARSHSR_SONoteCommand(HSRUpdate);UpdateSubStatusCmd(NEEDS_ATTENTION)"/></field>
            </event-listener>            
        </transition>
        <transition g="-11,-21" name="CANCEL_ORDER" to="Deleted">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="UpdateLegacyStatusCmd(DRAFT,DELETED);BuyerOutboundNotificationCmd(STATUS_CHANGE);AutoCancelCmd();"/></field>
            </event-listener>
        </transition>
        <transition g="-11,-21" name="SL_CANCEL_ORDER" to="Deleted">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="UpdateLegacyStatusCmd(DRAFT,DELETED);BuyerOutboundNotificationCmd(STATUS_CHANGE);UpdateSOCancellationCmd(CANCEL);SOLoggingCmd(deleteDraftSO);RelayOutboundNotificationCmd(ORDER_CANCELED_BY_CUSTOMER);"/></field>
            </event-listener>
        </transition>
        <transition g="-11,-21" name="INTEGRATION_CANCEL_ORDER" to="Deleted">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SEARSHSR_SONoteCommand(HSRCancel,NEW_STATUS:Deleted);UpdateLegacyStatusCmd(DRAFT,DELETED);BuyerOutboundNotificationCmd(STATUS_CHANGE);SEARSRI_SONoteCommand(WSCancelled,DRAFT,DELETED);SOLoggingCmd(cancellingOrder,DRAFT,DELETED);AutoCancelCmd();"/></field>
            </event-listener>
        </transition>
        <transition g="-11,-21" name="INTEGRATION_CANCEL" to="Deleted" >
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="ASN_CreateInvoiceforAssurantCancelCmd();UpdateLegacyStatusCmd(DRAFT,DELETED);BuyerOutboundNotificationCmd(STATUS_CHANGE);ASN_SONoteCommand(WSCancel);AutoCancelCmd();"/></field>
            </event-listener>
        </transition>
        <transition g="-11,-21" name="NO_FEE_CANCEL_ORDER" to="Deleted">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="UpdateLegacyStatusCmd(DRAFT,DELETED);BuyerOutboundNotificationCmd(STATUS_CHANGE);AutoCancelCmd();"/></field>
            </event-listener>
        </transition>
		<transition g="627,644:-24,-20" name="SPEND_LIMIT_CHANGED" to="routingBehaviorCheckForSpendLimitChanged"/>
    </state>
    
    <decision name="IsManualReviewNeeded">
	<handler expr="#{manualReviewCheck}" />
	<transition name="ReviewNeeded" to="Draft">
 		<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
			<field name="commandList"><string value="SONoteCommand(StayInDraftReviewNeeded);UpdateSubStatusCmd(MANUAL_REVIEW);"/></field>
 	</event-listener>
	</transition>
	<transition name="NoReviewNeeded" to="IsTemplatePresent"/>
	</decision>
	
	<decision name="IsTemplatePresent">
	<handler expr="#{templatePresentCheck}" />
	<transition name="NoTemplate" to="Draft">
 		<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
			<field name="commandList"><string value="SONoteCommand(NoTemplate);UpdateSubStatusCmd(MISSING_INFORMATION);"/></field>
 		</event-listener>
	</transition>
	<transition name="HasTemplate" to="IsSPNPresent"/>
	</decision>
	
	<decision name="IsSPNPresent">
		<handler expr="#{SPNPresentCheck}" />
		<transition name="NoSPN" to="Draft">
	 		<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
				<field name="commandList"><string value="SONoteCommand(NoSPN);UpdateSubStatusCmd(NO_PROVIDERS);"/></field>
	 		</event-listener>
		</transition>
		<transition name="HasSPN" to="ProviderAvailabilityCheck">
			<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
				<field name="commandList"><string value="DisableTierRouteCmd();SetProvidersForAutoRoutingCmd();"/></field>
	 		</event-listener>
	 	</transition>
	</decision>
	<decision name="ProviderAvailabilityCheck">
        <handler expr="#{conditionalProvidersListCheck}" />
        <transition name="HasProviders" to="OrderTypeCheck"/>
        <transition name="NoProviders" to="Draft">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SONoteCommand(NoProviders);UpdateSubStatusCmd(NO_PROVIDERS)"/></field>
            </event-listener>
        </transition>
    </decision>
    
    <decision name="routingBehaviorCheckForSpendLimitChanged">
         <handler expr="#{autoRouteBehaviorCheck}" />
        <transition name="Conditional" to="ProviderListCheck">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="DisableTierRouteCmd()"/></field>
            </event-listener>
        </transition>
        <transition name="Tier" to="ProviderListCheck">
        <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SetAutoTierRoutingTime()"/></field>
            </event-listener>
        </transition>
        <transition name="Basic" to="ProviderListCheck">
        <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="DisableTierRouteCmd()"/></field>
            </event-listener>
        </transition>
        <transition name="None" to="ProviderListCheck">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="DisableTierRouteCmd()"/></field>
            </event-listener>
        </transition>
    </decision>

    <decision name="AutoRoutingBehaviorCheckForPost">
        <handler expr="#{autoRouteBehaviorCheck}" />
        <!-- Start SL 15642 Changes to update method of routing -->
        <transition name="Conditional" to="SetConditionalProvidersForPostedActivity">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="DisableTierRouteCmd();UpdateOrderRouteAttributeCmd(EXCLUSIVE);"/></field>
            </event-listener>
        </transition>
        <transition name="Tier" to="AutoRouteProviderListCheck" >
        <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="UpdateOrderRouteAttributeCmd(GENERAL);SetAutoTierRoutingTime();SetProvidersForAutoRoutingCmd();"/></field>
            </event-listener>
            </transition>
        <transition name="Basic" to="SetAutoRouteProvidersForPostedActivity" >
        <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="UpdateOrderRouteAttributeCmd(GENERAL);"/></field>
            </event-listener>
        </transition>
        <transition name="None" to="OrderTypeCheck">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="DisableTierRouteCmd();UpdateOrderRouteAttributeCmd(GENERAL);"/></field>
            </event-listener>
        </transition>
        <!-- End SL 15642 Changes to update method of routing -->
    </decision>

    <custom name="SetConditionalProvidersForPostedActivity" continue="async" class="com.servicelive.orderfulfillment.node.DefaultCustomActivity">
        <transition to="ConditionalProvidersListCheck">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SetProvidersForConditionalAutoRoutingCmd()"/></field>
            </event-listener>
        </transition>
    </custom>

    <custom name="SetAutoRouteProvidersForPostedActivity" continue="async" class="com.servicelive.orderfulfillment.node.DefaultCustomActivity">
        <transition to="AutoRouteProviderListCheck">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="DisableTierRouteCmd();SetProvidersForAutoRoutingCmd();"/></field>
            </event-listener>
        </transition>
    </custom>

    <custom name="AutoTierRoutePrepForPostedActivity" continue="async" class="com.servicelive.orderfulfillment.node.DefaultCustomActivity">
        <transition to="AutoRouteProviderListCheck">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SetAutoTierRoutingTime();SetProvidersForAutoRoutingCmd();"/></field>
            </event-listener>
        </transition>
    </custom>

    <decision name="ConditionalProvidersListCheck">
        <handler expr="#{conditionalProvidersListCheck}"/>
        <transition name="HasProviders" to="OrderTypeCheck">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SaveConditionalRoutingNoteCmd();PriceReductionCmd()"/></field>
            </event-listener>
        </transition>
        <transition name="NoProviders" to="Draft">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SaveConditionalRoutingNoteCmd();UpdateSubStatusCmd(NO_PROVIDERS);DecreaseSpendingCmdFromPostToDraft();PriceReductionCmd();"/></field>
            </event-listener>
        </transition>
    </decision>

    <decision name="AutoRouteProviderListCheck">
        <handler expr="#{conditionalProvidersListCheck}" />
        <transition name="HasProviders" to="OrderTypeCheck"/>
        <transition name="NoProviders" to="Draft">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="UpdateSubStatusCmd(NO_PROVIDERS);DecreaseSpendingCmdFromPostToDraft()"/></field>
            </event-listener>
        </transition>
    </decision>

 	<decision name="ProviderListCheck">
        <handler expr="#{conditionalProvidersListCheck}" />
        <transition name="HasProviders" to="OrderTypeCheck"/>
        <transition name="NoProviders" to="Draft">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="UpdateSubStatusCmd(NO_PROVIDERS)"/></field>
            </event-listener>
        </transition>
    </decision>
    
    <!--SL 15642 Start  Changes in the car rule evaluation.Checking buyer has car feature ON. -->
    <decision name="ConditionalRouteFeatureOn">
    <handler expr="#{conditionalRouteFeatureOn}"></handler>
    <transition name="YES" to="SetConditionalRuleForSo"></transition>
    <transition name="NO" to="AutoRoutingBehaviorCheckForPost"></transition>
    </decision>
    <!-- End of Changes in the car rule evaluation  -->
    
     <!--SL 15642 Start  Changes in the car rule evaluation. Creating a decision to handle association of rule with SO  -->
    <decision name="SetConditionalRuleForSo">
    <handler expr="#{associateRuleWithSo}"></handler>
    <transition name="YES" to="autoAcceptFeatureCheck">
	    <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy" propagation="enabled">
		    <field  name="commandList">
		    <!--SL-19021 Reverting the changes made in last release -->
		    <string value="UpdateOrderRouteAttributeCmd(EXCLUSIVE);UpdateProvidersForConditionalAutoRoutingCmd();"/>
	    </field>
	    </event-listener>
    </transition>
     <transition name="NO" to="AutoRoutingBehaviorCheckForPost">
	     <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy" propagation="enabled">
		     <field  name="commandList">
		     <string value="UpdateOrderRouteAttributeCmd(GENERAL);"/>
		     </field>
	     </event-listener>
     </transition>
      <!--priority 4 issue changes  -->
      <!--If no matching rule is found for Inhome order, place the order in Draft status -->
     <transition name="NoMatchingRule" to="Draft">
     	<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy" propagation="enabled">
    		<field  name="commandList">
    			<string value="UpdateSubStatusCmd(NO_MATCHING_RULE);SONoteCommand(NoMatchingRule);SOLoggingCmd(noMatchingRuleLogging);"/>
   			 </field>
    	</event-listener>
     </transition>
   </decision>
    <!--SL 15642 End  Changes in the car rule evaluation  -->
    
    <!-- SL 15642 Start Checking the Auto Acceptance Buyer feature set of a buyer -->
    <decision name="autoAcceptFeatureCheck">
	     <handler expr="#{autoAcceptFeatureCheck}"></handler>
	     <transition name="YES" to="evalVendorForSo"></transition>
	     <transition name="NO" to="AutoRoutingBehaviorCheckForPost"></transition>
    </decision>
    <!-- SL 15642 End Checking the Auto Acceptance Buyer feature set of a buyer -->
    
    <!-- SL 15642 Start Assigning Vendor under a rule after checking required condition  -->
    <decision name="evalVendorForSo">
    <handler expr="${evalAndSetVendorForSo}"></handler>
    <transition name="SINGLE" to="evalProviderForAutoAcceptance"></transition>
     <transition name="NO" to="AutoRoutingBehaviorCheckForPost"></transition>
     <!-- SL 19021 Setting TODRAFT when no service provider found between intersection of SPN and Rule -->
	 <transition name="TODRAFT" to="Draft">
	    <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy" propagation="enabled">
				 <field  name="commandList">
							 <string value="SaveConditionalRoutingNoteCmd();UpdateSubStatusCmd(NO_PROVIDERS);DecreaseSpendingCmdFromPostToDraft();PriceReductionCmd();">
							 </string>
				 </field>
		 </event-listener>
	 </transition>
     <transition name="NOVENDORS" to="AutoRoutingBehaviorCheckForPost"></transition>
     <transition name="MANYVENDORS" to="AutoRoutingBehaviorCheckForPost"></transition>
   </decision>
    <!-- SL 15642 End Assigning Vendor under a rule after checking required condition  -->
    
    <!-- SL 15642 Start Checking the eligibility of provider under a rule for auto acceptance -->
    <decision name="evalProviderForAutoAcceptance">
    <handler expr="${evalProviderForAutoAcceptance}"></handler>
    <transition name="YES" to="Accepted">
    <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy" propagation="enabled">
		    <field  name="commandList">
		    <string value="DisableTierRouteCmd();SOLoggingRouteCmd(routeToProvidersLogging);UpdateLegacyStatusCmd(POSTED,ACCEPTED);BuyerOutboundNotificationCmd(POSTED);BuyerOutboundNotificationCmd(STATUS_CHANGE);GetWalletPostInfoCmd();UpdateSoHdrOnAutoAccept();
		    BuyerCallbackNotificationCmd(ACCEPT_ORDER);AlertCmd(emailForBuyerPostReceipt);UpdateOrderAcceptAttributeCmd(AUTOMATIC);PriceReductionCmd();
		    SpendLimitChangeCmd();SOLoggingCmd(autoAcceptUpdateLogging);SaveConditionalRoutingNoteCmd();CheckAndSendAlertCmd(emailForRoutedSO,smsForRoutedSO);"/>
		    
		    </field>
	    </event-listener>
	 </transition>
	 <transition name="NO" to="Draft">
		 <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy" propagation="enabled">
				 <field  name="commandList">
							 <string value="UpdateSubStatusCmd(NO_PROVIDERS);DecreaseSpendingCmdFromPostToDraft();PriceReductionCmd();">
							 </string>
				 </field>
		 </event-listener>
	</transition>
    </decision>
    <!-- SL 15642 End Checking the eligibility of provider under a rule for auto acceptance  -->
    
    
    <decision g="309,303,38,48" name="OrderTypeCheck">
        <!-- expr is used to inject spring bean -->
        <handler expr="#{isOrderTypeNameYourPrice}" />
        <transition g="249,188:-42,-7" name="ZERO_PRICE_BID" to="PostLogAndAlertActivityForBidPosted"/>
        <transition g="454,237:-22,-3" name="BULLETIN" to="PostLogAndAlertActivityForBidPosted"/>
        <transition g="-10,-11" name="NAME_PRICE" to="AreFundsRequired"/>
    </decision>

    <custom name="PostLogAndAlertActivityForBidPosted" class="com.servicelive.orderfulfillment.node.DefaultCustomActivity">
        <transition to="BidPosted">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="UpdateLegacyStatusCmd(DRAFT,POSTED);BuyerOutboundNotificationCmd(STATUS_CHANGE);GetWalletPostInfoCmd();SOLoggingRouteCmd(routeToProvidersLogging);CheckAndSendAlertCmd(emailForRoutedSO,smsForRoutedSO);AlertCmd(emailForBuyerPostReceipt)"/></field>
            </event-listener>
        </transition>
    </custom>

	<decision g="308,392,38,48" name="AreFundsRequired">
        <handler expr="#{areFundsRequired}" />
		<transition g="-53,-11" name="false" to="Posted">
			<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
				<field name="commandList"><string value="UpdateLegacyStatusCmd(DRAFT,POSTED);BuyerOutboundNotificationCmd(STATUS_CHANGE);GetWalletPostInfoCmd();SOLoggingRouteCmd(routeToProvidersLogging);CheckAndSendAlertCmd(emailForRoutedSO,smsForRoutedSO);AlertCmd(emailForBuyerPostReceipt)"/></field>
			</event-listener>
		</transition>
		<transition g="-8,-11" name="true" to="WalletPostCommandCheckForPosted"/>
	</decision>

    <decision g="911,496,38,48" name="WalletPostCommandCheckForPosted">
        <handler expr="#{isPostCommandDone}" />
        <transition g="-7,-47" name="false" to="IsAutoFundedForPosted"/>
        <transition g="-212,-9" name="true" to="OrderSpendLimitChangeCheck"/>
    </decision>

    <decision g="308,392,38,48" name="OrderSpendLimitChangeCheck">
        <handler expr="#{spendLimitChanged}" />
        <transition g="-53,-11" name="increase" to="IsAutoFundedForIncreaseInPost">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SOLoggingCmd(spendLimitUpdateLogging);UpdateLegacyStatusCmd(DRAFT,POSTED);BuyerOutboundNotificationCmd(STATUS_CHANGE);SOLoggingRouteCmd(routeToProvidersLogging);SOLoggingCmd(repostedWithUpdateLogging);"/></field>
            </event-listener>
        </transition>
        <transition g="-8,-11" name="decrease" to="DecFundsRequested">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="DecreaseSpendingCmd();SOLoggingCmd(spendLimitUpdateLogging);UpdateLegacyStatusCmd(DRAFT,POSTED);BuyerOutboundNotificationCmd(STATUS_CHANGE);SOLoggingRouteCmd(routeToProvidersLogging);SOLoggingCmd(repostedWithUpdateLogging);"/></field>
            </event-listener>
        </transition>
        <transition g="-53,-35" name="noChange" to="Posted">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="CheckAndSendAlertCmd(emailForRoutedSO,smsForRoutedSO);AlertCmd(emailForBuyerPostReceipt);UpdateLegacyStatusCmd(DRAFT,POSTED);BuyerOutboundNotificationCmd(STATUS_CHANGE);SOLoggingCmd(repostedWithUpdateLogging);"/></field>
            </event-listener>
        </transition>
        <transition g="-99,-99" name="repost" to="Posted">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="CheckAndSendAlertCmd(emailForRoutedSO,smsForRoutedSO);AlertCmd(emailForBuyerPostReceipt);UpdateLegacyStatusCmd(DRAFT,POSTED);BuyerOutboundNotificationCmd(STATUS_CHANGE);SOLoggingCmd(repostedWithUpdateLogging);"/></field>
            </event-listener>
        </transition>
    </decision>

    <decision g="308,392,38,48" name="IsAutoFundedForIncreaseInPost">
        <handler expr="#{isAutoFunded}" />
        <transition g="-53,-11" name="true" to="IncFundsRequested">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="IncreaseSpendingCmd();"/></field>
            </event-listener>
        </transition>
        <transition g="-8,-11" name="false" to="IncFundsRequested">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="CheckAvailableBalanceForIncreaseCmd();IncreaseSpendingCmd();"/></field>
            </event-listener>
        </transition>
    </decision>
	<decision g="308,392,38,48" name="IsAutoFundedForAddFundInAccepted">
        <handler expr="#{isAutoFunded}" />
        <transition g="-53,-11" name="true" to="Accepted">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="IncreaseSpendingCmd();AlertCmd(emailForAddFunds)"/></field>
            </event-listener>
        </transition>
        <transition g="-8,-11" name="false" to="Accepted">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="CheckAvailableBalanceForIncreaseCmd();IncreaseSpendingCmd();AlertCmd(emailForAddFunds)"/></field>
            </event-listener>
        </transition>
    </decision>
    
   <decision g="308,392,38,48" name="IsSpendLimitIncreasedForAccepted">
        <handler expr="#{spendLimitIncreased}" />
        <transition g="-53,-11" name="spendLimit" to="IsAutoFundedForAddFundInAccepted">
        	<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SpendLimitHistoryUpdateCmd();RelayOutboundNotificationCmd(ORDER_SPENDLIMIT_UPDATE)"/></field>
            </event-listener>
       </transition>
          <transition g="-53,-11" name="spendLimitDecreaseForRelay" to="Accepted">
        	<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="DecreaseSpendingCmd();SpendLimitHistoryUpdateCmd();RelayOutboundNotificationCmd(ORDER_SPENDLIMIT_UPDATE)"/></field>
            </event-listener>
       </transition> 
              <transition g="-53,-11" name="spendLimitDecreaseUpdateLocCon" to="Accepted">
        	<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="DecreaseSpendingCmd();SpendLimitHistoryUpdateCmd();AlertCmd(emailForUpdatedSO);RelayOutboundNotificationCmd(ORDER_SPENDLIMIT_UPDATE)"/></field>
            </event-listener>
       </transition>      
       <transition g="-53,-11" name="spendLimitUpdateLocCon" to="IsAutoFundedForAddFundInAccepted">
        	<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SpendLimitHistoryUpdateCmd();AlertCmd(emailForUpdatedSO);RelayOutboundNotificationCmd(ORDER_SPENDLIMIT_UPDATE)"/></field>
            </event-listener>
       </transition>
       <transition g="-53,-11" name="updateLocCon" to="Accepted">
        	<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="AlertCmd(emailForUpdatedSO);"/></field>
            </event-listener>
       </transition>
        <transition g="-8,-11" name="false" to="Accepted" />
    </decision>
    
    
	<decision g="308,392,38,48" name="IsAutoFundedForAddFundInActive">
        <handler expr="#{isAutoFunded}" />
        <transition g="-53,-11" name="true" to="Active">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="IncreaseSpendingCmd();AlertCmd(emailForAddFunds)"/></field>
            </event-listener>
        </transition>
        <transition g="-8,-11" name="false" to="Active">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="CheckAvailableBalanceForIncreaseCmd();IncreaseSpendingCmd();AlertCmd(emailForAddFunds)"/></field>
            </event-listener>
        </transition>
    </decision>
    
   <decision g="308,392,38,48" name="IsSpendLimitIncreasedForActive">
        <handler expr="#{spendLimitIncreased}" />
        <transition g="-53,-11" name="spendLimit" to="IsAutoFundedForAddFundInActive">
        	<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SpendLimitHistoryUpdateCmd();RelayOutboundNotificationCmd(ORDER_SPENDLIMIT_UPDATE)"/></field>
            </event-listener>
       </transition>
    <transition g="-53,-11" name="spendLimitDecreaseForRelay" to="Active">
        	<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="DecreaseSpendingCmd();SpendLimitHistoryUpdateCmd();RelayOutboundNotificationCmd(ORDER_SPENDLIMIT_UPDATE)"/></field>
            </event-listener>
       </transition> 
      <transition g="-53,-11" name="spendLimitDecreaseUpdateLocCon" to="Active">
        	<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="DecreaseSpendingCmd();SpendLimitHistoryUpdateCmd();AlertCmd(emailForUpdatedSO);RelayOutboundNotificationCmd(ORDER_SPENDLIMIT_UPDATE)"/></field>
            </event-listener>
       </transition>       
       <transition g="-53,-11" name="spendLimitUpdateLocCon" to="IsAutoFundedForAddFundInActive">
        	<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SpendLimitHistoryUpdateCmd();AlertCmd(emailForUpdatedSO);RelayOutboundNotificationCmd(ORDER_SPENDLIMIT_UPDATE)"/></field>
            </event-listener>
       </transition>
       <transition g="-53,-11" name="updateLocCon" to="Active">
        	<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="AlertCmd(emailForUpdatedSO);"/></field>
            </event-listener>
       </transition>
        <transition g="-8,-11" name="false" to="Active" />
    </decision>
    
   <decision g="308,392,38,48" name="IsAutoFundedForAddFundInProblem">
        <handler expr="#{isAutoFunded}" />
        <transition g="-53,-11" name="true" to="Problem">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="IncreaseSpendingCmd();AlertCmd(emailForAddFunds)"/></field>
            </event-listener>
        </transition>
        <transition g="-8,-11" name="false" to="Problem">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="CheckAvailableBalanceForIncreaseCmd();IncreaseSpendingCmd();AlertCmd(emailForAddFunds)"/></field>
            </event-listener>
        </transition>
    </decision>
     
    <decision g="308,392,38,48" name="IsSpendLimitIncreasedForProblem">
        <handler expr="#{spendLimitIncreased}" />
        <transition g="-53,-11" name="spendLimit" to="IsAutoFundedForAddFundInProblem">
        	<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SpendLimitHistoryUpdateCmd();RelayOutboundNotificationCmd(ORDER_SPENDLIMIT_UPDATE)"/></field>
            </event-listener>
       </transition>
         <transition g="-53,-11" name="spendLimitDecreaseForRelay" to="Problem">
        	<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="DecreaseSpendingCmd();SpendLimitHistoryUpdateCmd();RelayOutboundNotificationCmd(ORDER_SPENDLIMIT_UPDATE)"/></field>
            </event-listener>
       </transition> 
        <transition g="-53,-11" name="spendLimitDecreaseUpdateLocCon" to="Problem">
        	<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="DecreaseSpendingCmd();SpendLimitHistoryUpdateCmd();AlertCmd(emailForUpdatedSO);RelayOutboundNotificationCmd(ORDER_SPENDLIMIT_UPDATE)"/></field>
            </event-listener>
       </transition>  
       <transition g="-53,-11" name="spendLimitUpdateLocCon" to="IsAutoFundedForAddFundInProblem">
        	<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SpendLimitHistoryUpdateCmd();AlertCmd(emailForUpdatedSO);RelayOutboundNotificationCmd(ORDER_SPENDLIMIT_UPDATE)"/></field>
            </event-listener>
       </transition>
       <transition g="-53,-11" name="updateLocCon" to="Problem">
        	<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="AlertCmd(emailForUpdatedSO);"/></field>
            </event-listener>
       </transition>
       <transition g="-8,-11" name="false" to="Problem"/>
    </decision>
    
    <decision g="308,392,38,48" name="IsAutoFundedForPosted">
        <handler expr="#{isAutoFunded}" />
        <transition g="-53,-11" name="true" to="PostFundsRequested">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="PostCmd();UpdateLegacyStatusCmd(DRAFT,POSTED);BuyerOutboundNotificationCmd(STATUS_CHANGE);"/></field>
            </event-listener>
        </transition>
        <transition g="-8,-11" name="false" to="PostFundsRequested">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="CheckAvailableBalanceCmd();PostCmd();UpdateLegacyStatusCmd(DRAFT,POSTED);BuyerOutboundNotificationCmd(STATUS_CHANGE);"/></field>
            </event-listener>
        </transition>
    </decision>

    <script g="165,486,196,52" name="IncFundsRequested" expr="0" var="loopCounter">
    	<on event="start">
    		<event-listener
    			class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
    			<field name="commandList"><string value="UpdateSubStatusCmd(PENDING_WALLET_CONFIRMATION);"/></field>
   			</event-listener>
    	</on>
        <transition g="383,557:-61,-13" name="IncFundsAvailableCheckTimer" to="IncFundsAvailableCheckTimer"/>
    </script>

    <state g="1030,723,197,40" name="IncFundsAvailableCheckTimer">
        <transition g="1046,713;1046,688:-79,-11" name="IncFundsAvailableLoopCheck" to="IncFundsAvailableLoopCheck">
            <timer duedate="10 seconds"/>
            <script name="incrementLoopCounter"
                expr="#{loopCounter + 1}" var="loopCounter">
            </script>
        </transition>
        <transition name="ADMIN_CANCEL_PENDING_TRANSACTION" to="Draft">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="UpdateSubStatusCmd(NULL);ClearJmsMessageIdCmd();UpdateLegacyStatusCmd(POSTED, DRAFT);BuyerOutboundNotificationCmd(STATUS_CHANGE);"/>
                </field>
            </event-listener>
        </transition>
    </state>

    <decision name="IncFundsAvailableLoopCheck">
        <transition to="IncFundsAvailableCheck" >
            <condition expr="#{loopCounter == 3}"/>
            <event-listener
                class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="RecordJmsMessageIdCmd();AlertCmd(emailForWalletRequestTimeout);"/></field>
               </event-listener>
        </transition>
        <transition name="Default" to="IncFundsAvailableCheck"/>
    </decision>

    <decision g="410,470,48,48" name="IncFundsAvailableCheck">
        <handler expr="#{fundsConfirmedCheck}" />
        <transition g="200,418:-26,-7" name="Wait" to="IncFundsAvailableCheckTimer"/>
        <transition g="28,94" name="Fail" to="Draft">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="UpdateLegacyStatusCmd(POSTED,DRAFT);UpdateSubStatusCmd(NULL);BuyerOutboundNotificationCmd(STATUS_CHANGE);ClearJmsMessageIdCmd();"/>
                </field>
            </event-listener>
        </transition>
        <transition g="-17,-1" name="Success" to="AlertActivityForSpendLimitChangeAndRepost">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="UpdateSubStatusCmd(NULL);ClearJmsMessageIdCmd();"/>
                </field>
            </event-listener>
        </transition>
    </decision>
    
    <script g="165,486,196,52" name="DecFundsRequested" expr="0" var="loopCounter">
    	<on event="start">
    		<event-listener
    			class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
    			<field name="commandList"><string value="UpdateSubStatusCmd(PENDING_WALLET_CONFIRMATION);"/></field>
   			</event-listener>
    	</on>
        <transition g="383,557:-61,-13" name="DecFundsAvailableCheckTimer" to="DecFundsAvailableCheckTimer"/>
    </script>

    <state g="1030,723,197,40" name="DecFundsAvailableCheckTimer">
        <transition g="1046,713;1046,688:-79,-11" name="DecFundsAvailableLoopCheck" to="DecFundsAvailableLoopCheck">
            <timer duedate="10 seconds"/>
            <script name="incrementLoopCounter"
                expr="#{loopCounter + 1}" var="loopCounter">
            </script>
        </transition>
        <transition name="ADMIN_CANCEL_PENDING_TRANSACTION" to="Draft">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="UpdateSubStatusCmd(NULL);ClearJmsMessageIdCmd();UpdateLegacyStatusCmd(POSTED, DRAFT);BuyerOutboundNotificationCmd(STATUS_CHANGE);"/>
                </field>
            </event-listener>
        </transition>
    </state>

    <decision name="DecFundsAvailableLoopCheck">
        <transition to="DecFundsAvailableCheck" >
            <condition expr="#{loopCounter == 3}"/>
            <event-listener
                class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="RecordJmsMessageIdCmd();AlertCmd(emailForWalletRequestTimeout);"/></field>
               </event-listener>
        </transition>
        <transition name="Default" to="DecFundsAvailableCheck"/>
    </decision>

    <decision g="410,470,48,48" name="DecFundsAvailableCheck">
        <handler expr="#{fundsConfirmedCheck}" />
        <transition g="200,418:-26,-7" name="Wait" to="DecFundsAvailableCheckTimer"/>
        <transition g="28,94" name="Fail" to="AlertActivityForSpendLimitChangeAndRepost">
        	<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="UpdateSubStatusCmd(NULL);ClearJmsMessageIdCmd();"/>
                </field>
            </event-listener>
        </transition>
        <transition g="-17,-1" name="Success" to="AlertActivityForSpendLimitChangeAndRepost">
        	<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="UpdateSubStatusCmd(NULL);ClearJmsMessageIdCmd();"/>
                </field>
            </event-listener>
        </transition>
    </decision>

    <script g="165,486,196,52" name="PostFundsRequested" expr="0" var="loopCounter">
        <on event="start">
            <event-listener
                class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="UpdateSubStatusCmd(PENDING_WALLET_CONFIRMATION);"/></field>
               </event-listener>
        </on>
        <transition g="383,557:-61,-13" to="PostFundsRequestedTimer"/>
    </script>

    <state g="1030,723,197,40" name="PostFundsRequestedTimer">
        <transition g="1046,713;1046,688:-79,-11" name="postCheckFundsAvailable" to="PostFundsRequestedLoopCheck">
            <timer duedate="10 seconds"/>
            <script name="incrementLoopCounter"
                expr="#{loopCounter + 1}" var="loopCounter">
            </script>
        </transition>
        <transition name="ADMIN_CANCEL_PENDING_TRANSACTION" to="Draft">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="UpdateSubStatusCmd(NULL);ClearJmsMessageIdCmd();UpdateLegacyStatusCmd(POSTED, DRAFT);BuyerOutboundNotificationCmd(STATUS_CHANGE);"/>
                </field>
            </event-listener>
        </transition>
    </state>

    <decision name="PostFundsRequestedLoopCheck">
        <transition to="PostFundsAvailableCheck" >
            <condition expr="#{loopCounter == 3}"/>
            <event-listener
                class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="RecordJmsMessageIdCmd();AlertCmd(emailForWalletRequestTimeout);"/></field>
               </event-listener>
        </transition>
        <transition name="Default" to="PostFundsAvailableCheck"/>
    </decision>
    
    <decision g="410,470,48,48" name="PostFundsAvailableCheck">
        <handler expr="#{fundsConfirmedCheck}" />
        <transition g="200,418:-26,-7" name="Wait" to="PostFundsRequestedTimer"/>
        <transition g="28,94" name="Fail" to="Draft">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="UpdateLegacyStatusCmd(POSTED,DRAFT);UpdateSubStatusCmd(NULL);BuyerOutboundNotificationCmd(STATUS_CHANGE);ClearJmsMessageIdCmd();"/>
                </field>
            </event-listener>
        </transition>
        <transition g="-17,-1" name="Success" to="PostLogAndAlertActivityForPosted">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="UpdateSubStatusCmd(NULL);ClearJmsMessageIdCmd();"/>
                </field>
            </event-listener>
        </transition>
    </decision>

    <custom name="PostLogAndAlertActivityForPosted" class="com.servicelive.orderfulfillment.node.DefaultCustomActivity">
        <transition to="Posted">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="GetWalletPostInfoCmd();SOLoggingRouteCmd(routeToProvidersLogging);CheckAndSendAlertCmd(emailForRoutedSO,smsForRoutedSO);AlertCmd(emailForBuyerPostReceipt)"/></field>
            </event-listener>
        </transition>
    </custom>

	<decision name="MajorChangesCheckInPost">
		<handler expr="#{majorChangesCheck}" />
		<transition name="skillCategoryChanged" to="CreateDocumentActivity"/>
		<transition name="otherMajorChanges" to="AutoRoutePrepActivity">
			<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="ResetAutoTierRoutingTimeCmd()"/></field>
            </event-listener>
		</transition>
		<transition name="noMajorChanges" to="OrderTypeCheck"/>
	</decision>

	<decision name="MajorChangesCheckInExpired">
		<handler expr="#{majorChangesCheck}" />
		<transition name="skillCategoryChanged" to="CreateDocumentActivity"/>
		<transition name="otherMajorChanges" to="AutoRoutePrepActivity">
			<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="ResetAutoTierRoutingTimeCmd()"/></field>
            </event-listener>
            </transition>
		<transition name="noMajorChanges" to="OrderTypeCheck"/>
	</decision>

	<state g="719,161,92,52" name="BidPosted">
        <on event="start">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="FireEventCmd(POSTED);RemoveFieldsCmd(MainJobCode,ServiceOrderChanges,ledgerPostingFee,ledgerSpendLimitRsrvTransactionId,ledgerSpendLimitRsrvAmt,ledgerPostTransactionId);"/>
                </field>
            </event-listener>
        </on>
        <transition g="107,709;102,490:-71,-20" name="EDIT_ORDER" to="OrderTypeCheck">
        	<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="ResetAutoTierRoutingTimeCmd()"/></field>
            </event-listener>
        </transition>
        <transition g="107,709;102,490:-71,-20" name="POST_ORDER" to="OrderTypeCheck"/>
        <transition g="650,360;650,459:-182,214" name="LOCK_FOR_EDIT" to="LockedInEdit"/>
        <transition g="627,644:-24,-20" name="EDIT_SCHEDULE" to="OrderTypeCheck"/>
        <transition g="650,360;650,459:-182,214" name="UPDATE_BATCH_ORDER" to="MajorChangesCheckInPost"/>
        <transition g="650,360;650,459:-182,214" name="ASN_UPDATE_BATCH_ORDER" to="BidPosted">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SONoteCommand(WSUpdate);"/></field>
            </event-listener>
        </transition>
        <transition g="878,154:10,-10" name="CREATE_CONDITIONAL_OFFER" to="SendAllCounterOfferAlertDecisionFromBidPosted" >
        	<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="AlertCmd(emailForProviderCondAccept);"/>
                </field>
            </event-listener>
        </transition>
        <transition g="869,144:4,-13" name="WITHDRAW_CONDITIONAL_OFFER" to="BidPosted">
        </transition>
        <transition g="-52,-5" name="ACCEPT_CONDITIONAL_OFFER" to="WalletPostCommandCheckFromBidPosted">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="UpdateLegacyStatusCmd(POSTED,ACCEPTED);BuyerOutboundNotificationCmd(STATUS_CHANGE);CheckAndSendAlertCmd(emailForAcceptSOForNonAP,emailForBuyerCondOffrAccept);"/>
                </field>
            </event-listener>
        </transition>
        <transition g="699,126:-33,-10" name="REJECT_ORDER" to="SendAllRejectAlertDecisionFromBidPosted"/>
        <transition g="-37,-1" name="CANCEL_ORDER" to="WalletPostCommandCheckForVoid" />
        <transition g="-6,-24" name="SL_CANCEL_ORDER" to="WalletPostCommandCheckForVoidInCancelOrder" />
        <transition g="-37,-1" name="INTEGRATION_CANCEL_ORDER" to="WalletPostCommandCheckForVoid">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SEARSRI_SONoteCommand(WSCancel);SEARSHSR_SONoteCommand(HSRCancel,NEW_STATUS:Voided);"/></field>
            </event-listener>
        </transition>
        <transition g="-11,-21" name="INTEGRATION_CANCEL" to="WalletPostCommandCheckForVoid" >
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="ASN_CreateInvoiceforAssurantCancelCmd();ASN_SONoteCommand(WSCancel);"/>
                </field>
            </event-listener>
        </transition>
        <transition g="403,21:2,1" name="ACKNOWLEDGE_BATCH_UPDATE" to="BidPosted">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SEARSHSR_SONoteCommand(HSRUpdate);UpdateSubStatusCmd(NEEDS_ATTENTION)"/></field>
            </event-listener>
        </transition>
        <transition g="-37,-1" name="NO_FEE_CANCEL_ORDER" to="WalletPostCommandCheckForVoid" />
        <transition g="-31,-20" name="expireOrder" to="Expired">
            <timer duedate="#{serviceExpireDate}"/>
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="UpdateLegacyStatusCmd(POSTED,EXPIRED);SOLoggingCmd(expireSOLogging);BuyerOutboundNotificationCmd(STATUS_CHANGE);AlertCmd(emailForExpireSO);RelayOutboundNotificationCmd(ORDER_EXPIRED);"/>
                </field>
            </event-listener>
        </transition>
        <transition name="tierIncrementTimer" to="BidPosted">
            <timer duedate="#{autoTierRouteDate}"/>
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SetAutoTierRoutingTime();SetProvidersForAutoRoutingCmd();SOLoggingRouteCmd(routeToProvidersLogging);CheckAndSendAlertCmd(emailForRoutedSO,smsForRoutedSO);"/></field>
            </event-listener>
        </transition>
    </state>

    <decision g="743,56,0,0" name="SendAllRejectAlertDecisionFromBidPosted">
        <handler expr="#{sendAllRejectAlertDecision}" />
    	<transition g="834,126:-60,-10" name="sendAllRejectAlert" to="RoutingBehaviourCheckForRejectBid">
			<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
				<field name="commandList"><string value="CheckAndSendAlertCmd(emailForAllRejectSO)"/></field>
			</event-listener>
    	</transition>
    	<transition g="-20,0" name="noAlert" to="BidPosted">
         </transition> 
    </decision>

    <state g="718,497,92,52" name="Posted">
        <on event="start">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="FireEventCmd(POSTED);RemoveFieldsCmd(MainJobCode,ServiceOrderChanges,loopCounter,jmsMessageId,walletMessageId,ledgerPostingFee,ledgerSpendLimitRsrvTransactionId,fundsConfirmedTransactionId,ledgerSpendLimitRsrvAmt,ledgerPostTransactionId,condAutoRouteRuleId,condAutoRouteRuleName)"/>
                </field>
            </event-listener>
        </on>
        <transition g="627,644:-24,-20" name="LOCK_FOR_EDIT" to="LockedInEdit"/>
        <transition g="107,709;102,490:-71,-20" name="EDIT_ORDER" to="OrderTypeCheck">
       		<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="ResetAutoTierRoutingTimeCmd()"/></field>
            </event-listener>
        </transition>
        <transition g="107,709;102,490:-71,-20" name="POST_ORDER" to="OrderTypeCheck"/>
        <transition g="1450,506:-68,-14" name="UPDATE_ORDER" to="Posted"/> 
        <transition g="107,609;102,500;-71,-23" name="UNPOST_ORDER" to="Draft">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="UpdateLegacyStatusCmd(POSTED,DRAFT);BuyerOutboundNotificationCmd(STATUS_CHANGE);DecreaseSpendingCmdFromPostToDraft()"/></field>
            </event-listener>
        </transition>
        <transition g="627,644:-24,-20" name="EDIT_SCHEDULE" to="OrderTypeCheck">
                    <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SOLoggingCmd(updateSOServiceDates);"/></field>
            </event-listener>
        </transition>
        <transition g="650,360;650,459:-182,214" name="UPDATE_BATCH_ORDER" to="MajorChangesCheckInPost"/>
        <transition g="650,360;650,459:-182,214" name="ASN_UPDATE_BATCH_ORDER" to="Posted">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SONoteCommand(WSUpdate);"/></field>
            </event-listener>
        </transition>
        <transition g="627,644:-24,-20" name="SPEND_LIMIT_CHANGED" to="AreFundsRequired"/>
        <transition g="-6,-24" name="CANCEL_ORDER" to="WalletPostCommandCheckForVoid" />
        <transition g="-6,-24" name="SL_CANCEL_ORDER" to="WalletPostCommandCheckForVoidInCancelOrder" />
        <transition g="-6,-24" name="INTEGRATION_CANCEL_ORDER" to="WalletPostCmdCheckForVoid" >
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SEARSHSR_SONoteCommand(HSRCancel,NEW_STATUS:Voided);"/></field>
            </event-listener>
        </transition>
        <transition g="-6,-24" name="NO_FEE_CANCEL_ORDER" to="WalletPostCommandCheckForVoid" />
        <transition g="-11,-21" name="INTEGRATION_CANCEL" to="WalletPostCommandCheckForVoid" >
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="ASN_CreateInvoiceforAssurantCancelCmd();ASN_SONoteCommand(WSCancel)"/></field>
            </event-listener>
        </transition>
        <transition g="403,21:2,1" name="ACKNOWLEDGE_BATCH_UPDATE" to="Posted">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SEARSHSR_SONoteCommand(HSRUpdate);UpdateSubStatusCmd(NEEDS_ATTENTION)"/></field>
            </event-listener>
        </transition>
        <transition g="723,592:-42,-6" name="REJECT_ORDER" to="SendAllRejectAlertDecisionFromPosted"/>
        <transition g="632,545:-171,-6" name="CREATE_CONDITIONAL_OFFER" to="SendAllCounterOfferAlertDecisionFromPosted" >
        	<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="AlertCmd(emailForProviderCondAccept);"/>
                </field>
            </event-listener>
        </transition>
        <transition g="622,530:-192,-5" name="WITHDRAW_CONDITIONAL_OFFER" to="Posted"/>
        <transition g="622,530:-192,-5" name="WITHDRAW_CONDITIONAL_OFFER_RESOURCE_LIST" to="Posted"/>
        
        <transition g="-38,3" name="ACCEPT_ORDER" to="WalletPostCommandCheck">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="UpdateLegacyStatusCmd(POSTED,ACCEPTED);SEARSRI_UpdateSubStatusCmd(FALSE);BuyerOutboundNotificationCmd(STATUS_CHANGE);BuyerCallbackNotificationCmd(ACCEPT_ORDER);CheckAndSendAlertCmd(emailForAcceptSOForNonAP);"/></field>
            </event-listener>
        </transition>
        
        <transition g="-38,5" name="ACCEPT_FOR_FIRM" to="WalletPostCommandCheck">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="UpdateLegacyStatusCmd(POSTED,ACCEPTED);SEARSRI_UpdateSubStatusCmd(FALSE);BuyerOutboundNotificationCmd(STATUS_CHANGE);BuyerCallbackNotificationCmd(ACCEPT_ORDER);CheckAndSendAlertCmd(emailForAcceptSOForNonAP);"/></field>
            </event-listener>
        </transition>
        
        <transition g="9,-72" name="ACCEPT_CONDITIONAL_OFFER" to="WalletPostCommandCheck">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="UpdateLegacyStatusCmd(POSTED,ACCEPTED);SEARSRI_UpdateSubStatusCmd(FALSE);BuyerOutboundNotificationCmd(STATUS_CHANGE);CheckAndSendAlertCmd(emailForAcceptSOForNonAP,emailForBuyerCondOffrAccept);"/>
                </field>
            </event-listener>
        </transition>
        <transition g="-31,-20" name="expireOrder" to="Expired">
            <timer duedate="#{serviceExpireDate}"/>
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="UpdateLegacyStatusCmd(POSTED,EXPIRED);SOLoggingCmd(expireSOLogging);BuyerOutboundNotificationCmd(STATUS_CHANGE);AlertCmd(emailForExpireSO);RelayOutboundNotificationCmd(ORDER_EXPIRED);"/>
                </field>
            </event-listener>
        </transition>
         <transition g="-31,-20" name="EXPIRE_ORDER_MANUALLY" to="Expired">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="UpdateLegacyStatusCmd(POSTED,EXPIRED);BuyerOutboundNotificationCmd(STATUS_CHANGE);AlertCmd(emailForExpireSO);"/>
                </field>
            </event-listener>
        </transition>
        <transition name="tierIncrementTimer" to="Posted">
            <timer duedate="#{autoTierRouteDate}"/>
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SetAutoTierRoutingTime();SetProvidersForAutoRoutingCmd();SOLoggingRouteCmd(routeToProvidersLogging);CheckAndSendAlertCmd(emailForRoutedSO,smsForRoutedSO);"/></field>
            </event-listener>
        </transition>
    </state>

	<!--  <decision name="AutoAcceptCheckForBuyerRescheduleinPosted">
	<handler expr="#{autoAcceptCheckBuyerReschedule}" />
	<transition name="true" to="Posted">
 		<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
			<field name="commandList"><string value="ScheduleUpdateCommand();SOLoggingCmd(buyerAcceptRescheduleLogging);updateServiceDateProcessVariableCmd();AlertCmd(emailProviderForAcceptReschedule);"/></field>
 		</event-listener>
	</transition>
	<transition name="false" to="Posted">
		<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                    <field name="commandList"><string value=""/></field>
		</event-listener>
	</transition>
	</decision>-->
	
	
    <decision g="911,496,38,48" name="WalletPostCommandCheckForVoid">
        <handler expr="#{isPostCommandDone}" />
        <transition g="-7,-47" name="false" to="Voided">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="SOLoggingCmd(voidOrder);UpdateLegacyStatusCmd(POSTED,VOIDED);BuyerOutboundNotificationCmd(STATUS_CHANGE);AutoCancelCmd();"/>
                </field>
            </event-listener>
        </transition>
        <transition g="-212,-9" name="true" to="Voided">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SOLoggingCmd(voidOrder);UpdateLegacyStatusCmd(POSTED,VOIDED);BuyerOutboundNotificationCmd(STATUS_CHANGE);VoidCmd();AutoCancelCmd();"/></field>
            </event-listener>
        </transition>
    </decision>
    
    <decision g="911,496,38,48" name="WalletPostCmdCheckForVoid">
        <handler expr="#{isPostCommandDone}" />
        <transition g="-7,-47" name="false" to="Voided">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="UpdateLegacyStatusCmd(POSTED,VOIDED);BuyerOutboundNotificationCmd(STATUS_CHANGE);SEARSRI_SONoteCommand(WSCancelled,POSTED,VOIDED);SOLoggingCmd(cancellingOrder,POSTED,VOIDED);AutoCancelCmd();"/>
                </field>
            </event-listener>
        </transition>
        <transition g="-212,-9" name="true" to="Voided">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="UpdateLegacyStatusCmd(POSTED,VOIDED);BuyerOutboundNotificationCmd(STATUS_CHANGE);VoidCmd();SEARSRI_SONoteCommand(WSCancelled,POSTED,VOIDED);SOLoggingCmd(cancellingOrder,POSTED,VOIDED);AutoCancelCmd();"/></field>
            </event-listener>
        </transition>
    </decision>
      <decision g="911,496,38,48" name="WalletPostCommandCheckForVoidInCancelOrder">
        <handler expr="#{isPostCommandDone}" />
        <transition g="-7,-47" name="false" to="Voided">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="SOLoggingCmd(voidOrderFromCancelOrderSignal);UpdateSOCancellationCmd(CANCEL);UpdateLegacyStatusCmd(POSTED,VOIDED);BuyerOutboundNotificationCmd(STATUS_CHANGE);RelayOutboundNotificationCmd(ORDER_CANCELED_BY_CUSTOMER);"/>
                </field>
            </event-listener>
        </transition>
        <transition g="-212,-9" name="true" to="Voided">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SOLoggingCmd(voidOrderFromCancelOrderSignal);UpdateSOCancellationCmd(CANCEL);UpdateLegacyStatusCmd(POSTED,VOIDED);BuyerOutboundNotificationCmd(STATUS_CHANGE);VoidCmd();RelayOutboundNotificationCmd(ORDER_CANCELED_BY_CUSTOMER);"/></field>
            </event-listener>
        </transition>
    </decision>

     <decision g="911,496,38,48" name="WalletPostCommandCheckForVoidFromExpired">
        <handler expr="#{isPostCommandDone}" />
        <transition g="-7,-47" name="false" to="Voided">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="SOLoggingCmd(voidOrderFromCancelOrderSignal);UpdateLegacyStatusCmd(EXPIRED,VOIDED);BuyerOutboundNotificationCmd(STATUS_CHANGE);AutoCancelCmd();"/>
                </field>
            </event-listener>
        </transition>
        <transition g="-212,-9" name="true" to="Voided">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SOLoggingCmd(voidOrderFromCancelOrderSignal);VoidCmd();UpdateLegacyStatusCmd(EXPIRED,VOIDED);BuyerOutboundNotificationCmd(STATUS_CHANGE);AutoCancelCmd();"/></field>
            </event-listener>
        </transition>
    </decision>
	<decision g="911,496,38,48" name="WalletPostCommandCheckForVoidInExpired">
        <handler expr="#{isPostCommandDone}" />
        <transition g="-7,-47" name="false" to="Voided">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="SOLoggingCmd(voidOrderFromCancelOrderSignal);UpdateSOCancellationCmd(CANCEL);UpdateLegacyStatusCmd(EXPIRED,VOIDED);BuyerOutboundNotificationCmd(STATUS_CHANGE);RelayOutboundNotificationCmd(ORDER_CANCELED_BY_CUSTOMER);"/>
                </field>
            </event-listener>
        </transition>
        <transition g="-212,-9" name="true" to="Voided">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SOLoggingCmd(voidOrderFromCancelOrderSignal);VoidCmd();UpdateSOCancellationCmd(CANCEL);UpdateLegacyStatusCmd(EXPIRED,VOIDED);BuyerOutboundNotificationCmd(STATUS_CHANGE);RelayOutboundNotificationCmd(ORDER_CANCELED_BY_CUSTOMER);"/></field>
            </event-listener>
        </transition>
    </decision>
	<decision g="308,392,38,48" name="IsAutoFundedForAcceptConditionalOffer">
        <handler expr="#{isAutoFunded}" />
		<transition g="-53,-11" name="true" to="AcceptCondOfferFundsRequested">
			<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
				<field name="commandList"><string value="IncreaseSpendingCmd();"/></field>
			</event-listener>
		</transition>
		<transition g="-8,-11" name="false" to="AcceptCondOfferFundsRequested">
			<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
				<field name="commandList"><string value="CheckAvailableBalanceForIncreaseCmd();IncreaseSpendingCmd();"/></field>
			</event-listener>
		</transition>
	</decision>

    <decision g="308,392,38,48" name="OrderSpendLimitChangeBeforeAcceptCheck">
        <handler expr="#{spendLimitChanged}" />
        <transition g="-53,-11" name="increase" to="IsAutoFundedForAcceptConditionalOffer">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SOLoggingCmd(spendLimitUpdateLogging);"/></field>
            </event-listener>
        </transition>
        <transition g="-53,-35" name="decrease" to="AlertActivityForAcceptConditionalOrder"/>
        <transition g="-53,-35" name="noChange" to="AlertActivityForAcceptConditionalOrder"/>
    </decision>
    
    <decision g="308,392,38,48" name="OrderSpendLimitChangeBeforeAcceptCheckFromBidPosted">
        <handler expr="#{spendLimitChanged}" />
        <transition g="-53,-11" name="increase" to="IsAutoFundedForAcceptConditionalOffer">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SOLoggingCmd(spendLimitUpdateLogging);"/></field>
            </event-listener>
        </transition>
        <transition g="-53,-35" name="decrease" to="AlertActivityForAcceptConditionalOrder">
        	<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="DecreaseSpendingCmd();SOLoggingCmd(spendLimitUpdateLogging);"/></field>
            </event-listener>
        </transition>
        <transition g="-53,-35" name="noChange" to="AlertActivityForAcceptConditionalOrder"/>
    </decision>

	<decision g="744,618,0,0" name="SendAllCounterOfferAlertDecisionFromPosted">
    	<handler expr="#{sendAllCounterOfferAlertDecision}" />
    	<transition g="400,575:0,0" name="sendAllRejectAlert" to="RoutingBehaviourCheckForCounterOffer"/>
    	<transition g="-19,-7" name="noAlert" to="Posted"/>
    </decision>
    
    <decision g="744,618,0,0" name="SendAllCounterOfferAlertDecisionFromBidPosted">
    	<handler expr="#{sendAllCounterOfferAlertDecision}" />
    	<transition g="400,575:0,0" name="sendAllRejectAlert" to="RoutingBehaviourCheckForCounterOffer"/>
    	<transition g="-19,-7" name="noAlert" to="BidPosted"/>
    </decision>

    <decision g="740,608,0,0" name="SendAllRejectAlertDecisionFromPosted">
    	<handler expr="#{sendAllRejectAlertDecision}" />
    	<transition g="400,575:0,0" name="sendAllRejectAlert" to="RoutingBehaviourCheckForReject">
			<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
				<field name="commandList"><string value="AlertCmd(emailForAllRejectSO)"/></field>
			</event-listener>
    	</transition>
    	<transition g="-19,-7" name="noAlert" to="Posted">
         </transition>
    </decision>
    
     <decision g="740,777,0,0" name="RoutingBehaviourCheckForCounterOffer">
    	<handler expr="#{routingBehaviourCheckForCounterOffer}" />
    	<transition g="400,667:0,0" name="tierRouted" to="Posted">
			<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
				<field name="commandList"><string value="SetAutoTierRoutingTime();SetProvidersForAutoRoutingCmd();CheckAndSendAlertCmd(emailForRoutedSO,smsForRoutedSO);"/></field>
			</event-listener>
    	</transition>
    	<transition g="-34,-7" name="autoRouted" to="Posted"/>
    </decision>
    
    <decision g="740,777,0,0" name="RoutingBehaviourCheckForReject">
    	<handler expr="#{routingBehaviourCheck}" />
    	<transition g="400,667:0,0" name="tierRouted" to="Posted">
			<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
				<field name="commandList"><string value="SetAutoTierRoutingTime();SetProvidersForAutoRoutingCmd();CheckAndSendAlertCmd(emailForRoutedSO,smsForRoutedSO);"/></field>
			</event-listener>
    	</transition>
    	<transition g="-34,-7" name="autoRouted" to="Posted">
    	<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="DisableTierRouteCmd();"/></field>
        </event-listener>
		</transition>
    </decision>
    
    
    <decision g="740,777,0,0" name="RoutingBehaviourCheckForRejectBid">
    	<handler expr="#{routingBehaviourCheck}" />
    	<transition g="400,667:0,0" name="tierRouted" to="BidPosted">
			<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
				<field name="commandList"><string value="SetAutoTierRoutingTime();SetProvidersForAutoRoutingCmd();CheckAndSendAlertCmd(emailForRoutedSO,smsForRoutedSO);"/></field>
			</event-listener>
    	</transition>
    	<transition g="-34,-7" name="autoRouted" to="BidPosted">
    	<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="DisableTierRouteCmd();"/></field>
        </event-listener>
		</transition>
    </decision>
    
     <decision g="740,777,0,0" name="RoutingBehaviourCheckForRelease">
    	<handler expr="#{routingBehaviourCheck}" />
    	<transition g="400,667:0,0" name="tierRouted" to="OrderTypeCheck">
			<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
				<field name="commandList"><string value="CheckAndSendAlertCmd(emailForRoutedSO,smsForRoutedSO);"/></field>
			</event-listener>
    	</transition>
    	<transition g="-34,-7" name="autoRouted" to="OrderTypeCheck">
		</transition>
    </decision>

	<decision g="911,496,38,48" name="WalletPostCommandCheck">
		<handler expr="#{isPostCommandDone}" />
		<transition g="-7,-47" name="false" to="AcceptanceFundsAvailableCheck"/>
		<transition g="-212,-9" name="true" to="OrderSpendLimitChangeBeforeAcceptCheck"/>
	</decision>
	
	<decision g="911,496,38,48" name="WalletPostCommandCheckFromBidPosted">
		<handler expr="#{isPostCommandDone}" />
		<transition g="-7,-47" name="false" to="AcceptanceFundsAvailableCheckForBid"/>
		<transition g="-212,-9" name="true" to="OrderSpendLimitChangeBeforeAcceptCheckFromBidPosted"/>
	</decision>

    <decision g="913,634,48,49" name="AcceptanceFundsAvailableCheckForBid">
		<handler expr="#{availableBalanceCheckAutoFundedBid}" />
		<transition g="522,753:-29,-20" name="false" to="AcceptanceFundsRequested">
			<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
				<field name="commandList"><string value="AddBuyerFundCmdForBid();"/></field>
			</event-listener>
		</transition>
		<transition g="994,597:-30,28" name="true" to="WalletPostRequested">
			<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
				<field name="commandList"><string value="PostCmd();"/></field>
			</event-listener>
		</transition>
		<transition g="994,597:-30,28" name="autofunded" to="WalletPostRequested">
			<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
				<field name="commandList"><string value="PostCmd();"/></field>
			</event-listener>
		</transition>
	</decision>


	<decision g="913,634,48,48" name="AcceptanceFundsAvailableCheck">
		<handler expr="#{availableBalanceCheckAutoFunded}" />
		<transition g="522,753:-29,-20" name="false" to="AcceptanceFundsRequested">
			<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
				<field name="commandList"><string value="AddBuyerFundCmd();"/></field>
			</event-listener>
		</transition>
		<transition g="994,597:-30,28" name="true" to="WalletPostRequested">
			<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
				<field name="commandList"><string value="PostCmd();"/></field>
			</event-listener>
		</transition>
		<transition g="994,597:-30,28" name="autofunded" to="WalletPostRequested">
			<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
				<field name="commandList"><string value="PostCmd();"/></field>
			</event-listener>
		</transition>
	</decision>

	<script g="1030,723,197,40" name="AcceptanceFundsRequested" expr="0" var="loopCounter">
        <transition g="1046,713;1046,688:-79,-11" name="AcceptanceFundsRequestedTimer" to="AcceptanceFundsRequestedTimer"/>
	</script>

    <state g="1030,723,197,40" name="AcceptanceFundsRequestedTimer">
        <transition g="1046,713;1046,688:-79,-11" name="acceptanceCheckFundsAvailable" to="AcceptanceFundsRequestedLoopCheck">
            <timer duedate="10 seconds"/>
            <script name="incrementLoopCounter"
                expr="#{loopCounter + 1}" var="loopCounter">
            </script>
        </transition>
        <transition name="ADMIN_CANCEL_PENDING_TRANSACTION" to="Posted">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="UpdateSubStatusCmd(NULL);ClearJmsMessageIdCmd();UpdateLegacyStatusCmd(ACCEPTED,POSTED);BuyerOutboundNotificationCmd(STATUS_CHANGE);"/>
                </field>
            </event-listener>
        </transition>
    </state>

    <decision name="AcceptanceFundsRequestedLoopCheck">
        <transition to="AcceptanceFundsRequestedCheck" >
            <condition expr="#{loopCounter == 3}"/>
            <event-listener
                class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="RecordJmsMessageIdCmd();UpdateSubStatusCmd(PENDING_WALLET_CONFIRMATION);AlertCmd(emailForWalletRequestTimeout);"/></field>
               </event-listener>
        </transition>
        <transition name="Default" to="AcceptanceFundsRequestedCheck"/>
    </decision>

	<decision g="1101,639,48,48" name="AcceptanceFundsRequestedCheck">
        <handler expr="#{fundsConfirmedCheck}" />
        <transition g="778,681;780,726:-26,4" name="Wait" to="AcceptanceFundsRequestedTimer"/>
        <transition g="1001,629:31,5" name="Fail" to="Expired">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="UpdateLegacyStatusCmd(POSTED,EXPIRED);SOLoggingCmd(expireSOLogging);AlertCmd(emailForExpireSO);UpdateSubStatusCmd(NULL);BuyerOutboundNotificationCmd(STATUS_CHANGE);ClearJmsMessageIdCmd();RelayOutboundNotificationCmd(ORDER_EXPIRED);"/>
                </field>
            </event-listener>
        </transition>
        <transition g="-15,-6" name="Success" to="WalletPostRequested">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="GetCreditCardDepositInfoCmd();AlertCmd(emailBuyerForCreditCardDeposit);PostCmd();UpdateSubStatusCmd(NULL);ClearJmsMessageIdCmd();"/>
                </field>
            </event-listener>
        </transition>
    </decision>

	<script g="1023,576,205,40" name="WalletPostRequested" expr="0" var="loopCounter">
        <transition g="1139,541:-29,-15" name="WalletPostFundsRequestedTimer" to="WalletPostFundsRequestedTimer"/>
	</script>

    <state g="1030,723,197,40" name="WalletPostFundsRequestedTimer">
        <transition g="1046,713;1046,688:-79,-11" name="walletPostFundsAvailable" to="WalletPostFundsRequestedLoopCheck">
            <timer duedate="10 seconds"/>
            <script name="incrementLoopCounter"
                expr="#{loopCounter + 1}" var="loopCounter">
            </script>
        </transition>
        <transition name="ADMIN_CANCEL_PENDING_TRANSACTION" to="Posted">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="UpdateSubStatusCmd(NULL);ClearJmsMessageIdCmd();UpdateLegacyStatusCmd(ACCEPTED,POSTED);BuyerOutboundNotificationCmd(STATUS_CHANGE);"/>
                </field>
            </event-listener>
        </transition>
    </state>

    <decision name="WalletPostFundsRequestedLoopCheck">
        <transition to="WalletPostRequestedCheck" >
            <condition expr="#{loopCounter == 3}"/>
            <event-listener
                class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="RecordJmsMessageIdCmd();UpdateSubStatusCmd(PENDING_WALLET_CONFIRMATION);AlertCmd(emailForWalletRequestTimeout);"/></field>
               </event-listener>
        </transition>
        <transition name="Default" to="WalletPostRequestedCheck">
        </transition>
    </decision>

	<decision g="1075,459,48,48" name="WalletPostRequestedCheck">
        <handler expr="#{fundsConfirmedCheck}" />
        <transition g="648,529:-24,4" name="Wait" to="WalletPostFundsRequestedTimer"/>
        <transition g="29,29" name="Fail" to="Expired">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="UpdateLegacyStatusCmd(POSTED,EXPIRED);SOLoggingCmd(expireSOLogging);BuyerOutboundNotificationCmd(STATUS_CHANGE);AlertCmd(emailForExpireSO);RelayOutboundNotificationCmd(ORDER_EXPIRED);"/>
                </field>
            </event-listener>
        </transition>
        <transition g="-119,-25" name="Success" to="AlertActivityForAcceptOrder">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="UpdateSubStatusCmd(NULL);"/>
                </field>
            </event-listener>
        </transition>
    </decision>

    <state g="946,311,92,52" name="Expired">
    	<on event="start">
	        <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
	            <field name="commandList">
	                <string value="FireEventCmd(EXPIRED)"/>
	            </field>
	        </event-listener>
	    </on>
        <transition g="989,281:-24,-20" name="EDIT_ORDER" to="MajorChangesCheckInExpired">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="UpdateLegacyStatusCmd(EXPIRED,POSTED);ResetAutoTierRoutingTimeCmd();"/>
                </field>
            </event-listener>
        </transition>
        <transition g="989,281:-24,-20" name="POST_ORDER" to="MajorChangesCheckInExpired">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="UpdateLegacyStatusCmd(EXPIRED,POSTED);"/>
                </field>
            </event-listener>
        </transition>
        <transition g="-58,3" name="CANCEL_ORDER" to="WalletPostCommandCheckForVoidFromExpired" />
        <transition g="-58,3" name="SL_CANCEL_ORDER" to="WalletPostCommandCheckForVoidInExpired" /> 
        <transition g="650,360;650,459:-182,214" name="UPDATE_BATCH_ORDER" to="MajorChangesCheckInExpired"/>
        <transition g="1450,506:-68,-14" name="UPDATE_ORDER" to="Expired"/>
        <transition g="-6,-24" name="INTEGRATION_CANCEL_ORDER" to="Voided" >
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SEARSHSR_SONoteCommand(HSRCancel,NEW_STATUS:Voided);VoidCmd();UpdateLegacyStatusCmd(EXPIRED,VOIDED);BuyerOutboundNotificationCmd(STATUS_CHANGE);SEARSRI_SONoteCommand(WSCancelled,EXPIRED,VOIDED);SOLoggingCmd(cancellingOrder,EXPIRED,VOIDED);AutoCancelCmd();"/></field>
            </event-listener>
        </transition>
    </state>

    <script g="1234,136,196,52" name="AcceptCondOfferFundsRequested" expr="0" var="loopCounter">
        <transition g="1547,166:-29,-15" name="AcceptCondOfferFundsRequestedTimer" to="AcceptCondOfferFundsRequestedTimer"/>
    </script>

    <state g="1030,723,197,40" name="AcceptCondOfferFundsRequestedTimer">
        <transition g="1046,713;1046,688:-79,-11" name="acceptCondOfferFundsAvailable" to="AcceptCondOfferFundsRequestedLoopCheck">
            <timer duedate="10 seconds"/>
            <script name="incrementLoopCounter"
                expr="#{loopCounter + 1}" var="loopCounter">
            </script>
        </transition>
        <transition name="ADMIN_CANCEL_PENDING_TRANSACTION" to="BidPosted">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="UpdateSubStatusCmd(NULL);ClearJmsMessageIdCmd();UpdateLegacyStatusCmd(ACCEPTED,POSTED);BuyerOutboundNotificationCmd(STATUS_CHANGE);"/>
                </field>
            </event-listener>
        </transition>
    </state>

    <decision name="AcceptCondOfferFundsRequestedLoopCheck">
        <transition to="AcceptCondOfferFundsRequestedCheck" >
            <condition expr="#{loopCounter == 3}"/>
            <event-listener
                class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="RecordJmsMessageIdCmd();UpdateSubStatusCmd(PENDING_WALLET_CONFIRMATION);AlertCmd(emailForWalletRequestTimeout);"/></field>
               </event-listener>
        </transition>
        <transition name="Default" to="AcceptCondOfferFundsRequestedCheck">
        </transition>
    </decision>

    <decision g="1564,227,48,48" name="AcceptCondOfferFundsRequestedCheck">
        <handler expr="#{fundsConfirmedCheck}" />
        <transition g="1071,232:-24,4" name="Wait" to="AcceptCondOfferFundsRequestedTimer"/>
        <transition g="263,-83" name="Fail" to="BidPosted">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="UpdateLegacyStatusCmd(ACCEPTED,POSTED);BuyerOutboundNotificationCmd(STATUS_CHANGE);"/>
                </field>
            </event-listener>
        </transition>
        <transition g="-18,-54" name="Success" to="AlertActivityForAcceptConditionalOrder">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="UpdateSubStatusCmd(NULL);"/>
                </field>
            </event-listener>
        </transition>
    </decision>

    <custom name="AlertActivityForAcceptOrder" class="com.servicelive.orderfulfillment.node.DefaultCustomActivity">
        <transition to="Accepted">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="GetWalletPostInfoCmd();CheckAndSendAlertCmd(emailForAcceptSO,pushAlertForAssignedSO);"/></field>
            </event-listener>
        </transition>
    </custom>

    <custom name="AlertActivityForAcceptConditionalOrder" class="com.servicelive.orderfulfillment.node.DefaultCustomActivity">
        <transition to="Accepted">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="GetWalletPostInfoCmd(true);CheckAndSendAlertCmd(emailForAcceptSO,pushAlertForAssignedSO);"/></field>
            </event-listener>
        </transition>
    </custom>

    <state g="382,683,155,52" name="LockedInEdit">
        <transition g="107,709;102,490:-71,-20" name="EDIT_ORDER" to="MajorChangesCheckInPost">
       	 	<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="ResetAutoTierRoutingTimeCmd()"/></field>
            </event-listener>
        </transition>
        <transition g="-74,-15" name="RELEASE_LOCK_FOR_EDIT" to="OrderTypeCheck"/>
    </state>

    <state g="1488,492,155,52" name="Accepted">
        <on event="start">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="FireEventCmd(ACCEPTED);RemoveFieldsCmd(PVKey_Comment,MainJobCode,ServiceOrderChanges,loopCounter,jmsMessageId,walletMessageId,ledgerPostingFee,ledgerSpendLimitRsrvTransactionId,fundsConfirmedTransactionId,ledgerSpendLimitRsrvAmt,ledgerPostTransactionId);"/>
                </field>
            </event-listener>
        </on>
        <transition g="1696,535:-43,2" name="ACTIVATE_ORDER" to="Active">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="UpdateLegacyStatusCmd(ACCEPTED,ACTIVE);BuyerOutboundNotificationCmd(STATUS_CHANGE);"/></field>
            </event-listener>
        </transition>
        <transition g="650,360;650,459:-182,214" name="UPDATE_BATCH_ORDER" to="LocationChangedCheckInAccept"/>
        <transition g="650,360;650,459:-182,214" name="ASN_UPDATE_BATCH_ORDER" to="Accepted">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SONoteCommand(WSUpdate);"/></field>
            </event-listener>
        </transition>
        <transition g="1450,506:-68,-14" name="ADD_FUND" to="IsAutoFundedForAddFundInAccepted">
        	<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SpendLimitHistoryUpdateCmd();RelayOutboundNotificationCmd(ORDER_SPENDLIMIT_UPDATE_FROM_FRONTEND)"/></field>
            </event-listener>
        </transition>
        <transition g="1450,506:-68,-14" name="UPDATE_ORDER" to="IsSpendLimitIncreasedForAccepted"/>   
        <transition g="-33,-5" name="IsActiveCheck" to="Active">
            <timer duedate="#{serviceDate}"/>
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="UpdateLegacyStatusCmd(ACCEPTED,ACTIVE);BuyerOutboundNotificationCmd(STATUS_CHANGE);"/></field>
            </event-listener>            
        </transition>
        <transition g="1450,547:-166,-9" name="BUYER_REQUEST_RESCHEDULE" to="AutoAcceptCheckForBuyerRescheduleinAccepted">
        </transition>
        <transition g="1527,448:-164,-2" name="BUYER_CANCEL_RESCHEDULE" to="Accepted">
        	<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="AlertCmd(emailProviderForCancelRescheduleRequest)"/></field>
            </event-listener>
        </transition>
        <transition g="1533,439:-163,-9" name="BUYER_ACCEPT_RESCHEDULE" to="Accepted">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="updateServiceDateProcessVariableCmd();BuyerOutboundNotificationCmd(RESCHEDULE);BuyerCallbackNotificationCmd(RESCHEDULE_ACCEPT);AlertCmd(emailProviderForAcceptReschedule)"/></field>
            </event-listener>
        </transition>
        <transition g="1518,463:-157,-5" name="BUYER_REJECT_RESCHEDULE" to="Accepted">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="AlertCmd(emailProviderForRejectReschedule)"/></field>
            </event-listener>
        </transition>
        <transition  name="PROVIDER_REQUEST_RESCHEDULE" to="AutoAcceptCheckForProviderRescheduleinAccepted">
			<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
				<field name="commandList"><string value="RelayOutboundNotificationCmd(ORDER_RESCHEDULE_INITIATED_BY_PROVIDER);AlertCmd(emailBuyerForRescheduleRequest);"/></field>
			</event-listener>
		</transition>
        <transition g="1547,422:-183,-16" name="PROVIDER_CANCEL_RESCHEDULE" to="Accepted">
        	<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="AlertCmd(emailBuyerForCancelRescheduleRequest);RelayOutboundNotificationCmd(ORDER_RESCHEDULE_CANCELLED_BY_PROVIDER);"/></field>
            </event-listener>
        </transition>
        <transition g="1534,425:-180,-8" name="PROVIDER_ACCEPT_RESCHEDULE" to="Accepted">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="updateServiceDateProcessVariableCmd();BuyerOutboundNotificationCmd(RESCHEDULE);BuyerCallbackNotificationCmd(RESCHEDULE_ACCEPT);AlertCmd(emailBuyerForAcceptReschedule);RelayOutboundNotificationCmd(ORDER_RESCHEDULE_ACCEPTED_BY_PROVIDER);"/></field>
            </event-listener>
        </transition>
        <transition g="1554,400:-174,-6" name="PROVIDER_REJECT_RESCHEDULE" to="Accepted">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="AlertCmd(emailBuyerForRejectReschedule);RelayOutboundNotificationCmd(ORDER_RESCHEDULE_REJECTED_BY_PROVIDER);"/></field>
            </event-listener>
        </transition>
        <transition g="-23,-54" name="CANCEL_ORDER" to="CancellationPenaltyCheck">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SOLoggingCmd(cancelOrder);UpdateLegacyStatusCmd(ACCEPTED,CANCELLED);BuyerCallbackNotificationCmd(CANCEL_ORDER);BuyerOutboundNotificationCmd(STATUS_CHANGE);AlertCmd(emailForCancelAcceptedSO,pushAlertForAcceptedCancelledSO)"/></field>
            </event-listener>
        </transition>
        <transition g="-23,-54" name="SL_CANCEL_ORDER" to="TripChargeOverrideCheckInAccepted">
        </transition>
        <transition g="-23,-54" name="INTEGRATION_CANCEL_ORDER" to="CancellationPenaltyCheckForPOSCancellation">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SEARSHSR_SONoteCommand(HSRUpdate);UpdateLegacyStatusCmd(ACCEPTED,CANCELLED);BuyerOutboundNotificationCmd(STATUS_CHANGE);SEARSRI_SONoteCommand(WSCancelled,ACCEPTED,CANCELLED);SOLoggingCmd(cancellingOrder,ACCEPTED,CANCELLED);BuyerCallbackNotificationCmd(CANCEL_ORDER);AlertCmd(emailForCancelAcceptedSO,pushAlertForAcceptedCancelledSO)"/></field>
            </event-listener>
        </transition>
        <transition g="-23,-54" name="INTEGRATION_CANCEL" to="Accepted">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="UpdateSubStatusCmd(NEEDS_ATTENTION);AlertCmd(emailForAssurantCancel);"/></field>
            </event-listener>
        </transition>
        <transition g="403,21:2,1" name="ACKNOWLEDGE_BATCH_UPDATE" to="Accepted">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SEARSHSR_SONoteCommand(HSRUpdate);UpdateSubStatusCmd(NEEDS_ATTENTION)"/></field>
            </event-listener>
        </transition>
        <transition g="1510,641:-61,22" name="PROVIDER_REPORT_PROBLEM" to="Problem">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="UpdateLegacyStatusCmd(ACCEPTED,PROBLEM);BuyerOutboundNotificationCmd(STATUS_CHANGE);UpdateProblemTypeCmd();AlertCmd(emailForProviderProblemReport)"/>
                </field>
            </event-listener>
        </transition>

        <transition g="1408,664:-59,36" name="BUYER_REPORT_PROBLEM" to="Problem">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="UpdateLegacyStatusCmd(ACCEPTED, PROBLEM);BuyerOutboundNotificationCmd(STATUS_CHANGE);UpdateProblemTypeCmd();AlertCmd(emailForBuyerProblemReport)"/>
                </field>
            </event-listener>
        </transition>
        <transition g="1340,694;1205,782;31,790;26,455:17,-19" name="PROVIDER_RELEASE_ORDER" to="RoutingBehaviourCheckForRelease">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="UpdateLegacyStatusCmd(ACCEPTED,POSTED);updateServiceDateProcessVariableCmd();"/>
                </field>
            </event-listener>
        </transition>
        <transition g="1341,694;1205,782;31,790;26,455:17,-19" name="PROVIDER_FIRM_RELEASE_ORDER" to="RoutingBehaviourCheckForRelease">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="UpdateLegacyStatusCmd(ACCEPTED,POSTED);updateServiceDateProcessVariableCmd();"/>
                </field>
            </event-listener>
        </transition>
        <transition g="1647,558;1777,553:-38,-1" name="ON_SITE_VISIT" to="Active">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="UpdateLegacyStatusCmd(ACCEPTED,ACTIVE);BuyerOutboundNotificationCmd(STATUS_CHANGE);RelayOutboundNotificationCmd(ORDER_CHECKED_IN_BY_PROVIDER);"/></field>
            </event-listener>
        </transition>
        <transition name="MANAGE_SCOPE" to="IsAutoFundedForAddFundInAccepted"/>
        <transition g="1696,535:-43,2" name="CANCEL_ORDER_API" to="ProviderCompensationCheckForAccepted"/>
    </state>
    
    
    
	<decision name="AutoAcceptCheckForProviderRescheduleinAccepted">
	<handler expr="#{autoAcceptCheck}" />
	<transition name="accept" to="Accepted">
 		<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
			<field name="commandList"><string value="ScheduleUpdateCommand();SOLoggingCmd(buyerAcceptRescheduleLogging);updateServiceDateProcessVariableCmd();BuyerOutboundNotificationCmd(SUB_STATUS_CHANGE);BuyerCallbackNotificationCmd(RESCHEDULE_ACCEPT);BuyerOutboundNotificationCmd(AUTO_ACCEPT);AlertCmd(emailProviderForAcceptReschedule);"/></field>
 		</event-listener>
	</transition>
	<transition name="reject" to="Accepted">
		<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
			<field name="commandList"><string value="RescheduleNullCommand();SOLoggingCmd(buyerRejectRescheduleLogging);AlertCmd(emailProviderForRejectReschedule)"/></field>
		</event-listener>
	</transition>
	<transition name="noaction" to="Accepted">
		<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
			<field name="commandList"><string value="BuyerOutboundNotificationCmd(SUB_STATUS_CHANGE);"/></field>
		</event-listener>
	</transition>
	</decision>
	
	<decision name="AutoAcceptCheckForBuyerRescheduleinAccepted">
	<handler expr="#{autoAcceptCheckBuyerReschedule}" />
	<transition name="true" to="Accepted">
 		<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
			<field name="commandList"><string value="ScheduleUpdateCommand();SOLoggingCmd(buyerRescheduleAutoAcceptLogging);updateServiceDateProcessVariableCmd();AlertCmd(emailAutoAcceptBuyerRescheduleRequest);"/></field>
 		</event-listener>
	</transition>
	<transition name="false" to="Accepted">
		<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
			<field name="commandList"><string value="AlertCmd(emailProviderForRescheduleRequest)"/></field>
		</event-listener>
	</transition>
	</decision>
	
    <decision name="LocationChangedCheckInAccept">
        <handler expr="#{locationChangedCheck}" />
        <transition name="true" to="TaskChangedCheckInAccept">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SONoteCommand(UpdateLocation);AlertCmd(changeOfLocation);"/></field>
            </event-listener>
        </transition>
        <transition name="false" to="TaskChangedCheckInAccept"/>
    </decision>

    <decision name="TaskChangedCheckInAccept">
        <handler expr="#{scopeChangedCheck}" />
        <transition name="true" to="OrderSpendLimitChangeCheckInAccepted">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="UpdateLegacyStatusCmd(ACCEPTED,PROBLEM);UpdateSubStatusCmd(SCOPE_CHANGE);BuyerOutboundNotificationCmd(STATUS_CHANGE);AlertCmd(changeOfScope);SOLoggingCmd(problemScopeChangeLogging);"/></field>
            </event-listener>
        </transition>
        <transition name="false" to="Accepted"/>
    </decision>

    <decision g="308,392,38,48" name="OrderSpendLimitChangeCheckInAccepted">
        <handler expr="#{spendLimitChanged}" />
        <transition g="-53,-11" name="increase" to="IsAutoFundedForIncreaseInAccepted">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SOLoggingCmd(spendLimitUpdateLogging);"/></field>
            </event-listener>
        </transition>
        <transition g="-8,-11" name="decrease" to="Problem">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="DecreaseSpendingCmd();SOLoggingCmd(spendLimitUpdateLogging);"/></field>
            </event-listener>
        </transition>
        <transition g="-53,-35" name="noChange" to="Problem"/>
    </decision>
    
    <custom name="AlertActivityForSpendLimitChangeAndRepost" class="com.servicelive.orderfulfillment.node.DefaultCustomActivity">
        <transition to="Posted">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="GetWalletPostInfoCmd(true);CheckAndSendAlertCmd(emailForRoutedSO,smsForRoutedSO);AlertCmd(emailForBuyerPostReceipt);"/></field>
            </event-listener>
        </transition>
    </custom>

    <decision g="308,392,38,48" name="IsAutoFundedForIncreaseInAccepted">
        <handler expr="#{isAutoFunded}" />
        <transition g="-53,-11" name="true" to="Problem">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="IncreaseSpendingCmd();"/></field>
            </event-listener>
        </transition>
        <transition g="-8,-11" name="false" to="Problem"/>
    </decision>
	
	<decision g="308,392,38,48" name="ProviderCompensationCheckForAccepted">
        <handler expr="#{payProviderCheck}" />
        <transition g="-81,-9" name="on" to="ProviderAcknowledgementCheckForAccepted"/>
        <transition g="-56,-1" name="off" to="CancellationPenaltyReleaseFundsRequested">
			<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
				<field name="commandList">
					<string value="UpdateLegacyStatusCmd(ACCEPTED,CANCELLED);BuyerOutboundNotificationCmd(STATUS_CHANGE);UpdateSOCancellationCmd(CANCEL);SOLoggingCmd(CancelSOWithPenalty);
						ReversingSpendLimitCmd();PriceUpdateCmd();IncreasingSpendLimitCmd();ProviderReleasePaymentCmd();AlertCmd(emailForCancelAcceptedSO,pushAlertForAcceptedCancelledSO);BuyerCallbackNotificationCmd(CANCEL_ORDER);RelayOutboundNotificationCmd(ORDER_CANCELED_BY_CUSTOMER);"/>
				</field>
			</event-listener>
		</transition>
		<transition g="-56,-1" name="nonfunded" to="Cancelled">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SOLoggingCmd(CancelSOWithoutPenalty);UpdateLegacyStatusCmd(ACCEPTED,CANCELLED);UpdateSOCancellationCmd(CANCEL);ReversingSpendLimitCmd();PriceUpdateCmd();BuyerCallbackNotificationCmd(CANCEL_ORDER);AlertCmd(emailForCancelAcceptedSO,pushAlertForAcceptedCancelledSO)"/></field>
            </event-listener>
        </transition>
    </decision>

    <decision g="308,392,38,48" name="ProviderAcknowledgementCheckForAccepted">
        <handler expr="#{providerVerbalAcknowledgmentCheck}" />
		<transition g="-81,-9" name="true" to="CancellationPenaltyReleaseFundsRequested">
			<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
				<field name="commandList">
					<string value="UpdateLegacyStatusCmd(ACCEPTED,CANCELLED);BuyerOutboundNotificationCmd(STATUS_CHANGE);UpdateSOCancellationCmd(CANCEL);SOLoggingCmd(CancelSOWithPenalty);
							ReversingSpendLimitCmd();PriceUpdateCmd();IncreasingSpendLimitCmd();ProviderReleasePaymentCmd();AlertCmd(emailForCancelAcceptedSO,pushAlertForAcceptedCancelledSO);BuyerCallbackNotificationCmd(CANCEL_ORDER);RelayOutboundNotificationCmd(ORDER_CANCELED_BY_CUSTOMER);"/>
				</field>
			</event-listener>
		</transition>
		<transition g="-56,-1" name="false" to="PendingCancel">
			<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
				<field name="commandList">
					<string value="ReversingSpendLimitCmd();UpdateLegacyStatusCmd(ACCEPTED,PENDINGCANCEL);UpdateSOCancellationCmd(PENDINGCANCEL);
							SOLoggingCmd(pendingCancelLogging);AlertCmd(emailForPendingCancelSO);UpdatePendingCancelHistoryCmd();PriceUpdateForPndngCnclCmd();IncreasingSpendLimitCmd();"/>
				</field>
			</event-listener>
		</transition>
    </decision>
    
    <state g="1836,484,136,52" name="Active">
        <on event="start">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="FireEventCmd(ACTIVE);RemoveFieldsCmd(MainJobCode,ServiceOrderChanges,loopCounter,jmsMessageId,walletMessageId,ledgerPostingFee,ledgerSpendLimitRsrvTransactionId,fundsConfirmedTransactionId,ledgerSpendLimitRsrvAmt,ledgerPostTransactionId,PVKey_Comment);"/>
                </field>
            </event-listener>
        </on>
        <transition g="650,360;650,459:-182,214" name="UPDATE_BATCH_ORDER" to="LocationChangedCheckInActive"/>
        <transition g="650,360;650,459:-182,214" name="ASN_UPDATE_BATCH_ORDER" to="Active">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SONoteCommand(WSUpdate);"/></field>
            </event-listener>
        </transition>
        <transition g="2011,620;2010,698:-49,-52" name="COMPLETE_ORDER" to="AutoCloseBuyerFeatureCheckInActive">
             <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SOCompletionNoteCmd()"/></field>
            </event-listener>
        </transition>
        
        <transition g="1450,506:-68,-14" name="ADD_FUND" to="IsAutoFundedForAddFundInActive">
        	<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SpendLimitHistoryUpdateCmd();RelayOutboundNotificationCmd(ORDER_SPENDLIMIT_UPDATE_FROM_FRONTEND)"/></field>
            </event-listener>
        </transition>
        
        <transition g="1450,506:-68,-14" name="UPDATE_ORDER" to="IsSpendLimitIncreasedForActive"/> 
                   
        <transition g="2012,538:7,-9" name="BUYER_REQUEST_RESCHEDULE" to="AutoAcceptCheckForBuyerRescheduleinActive">
        </transition>
        <transition g="1998,572:11,-1" name="BUYER_CANCEL_RESCHEDULE" to="Active">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="AlertCmd(emailProviderForCancelRescheduleRequest)"/></field>
            </event-listener>            
        </transition>
        <transition g="1801,399;1645,402:-73,-16" name="BUYER_ACCEPT_RESCHEDULE" to="Accepted">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="UpdateLegacyStatusCmd(ACTIVE,ACCEPTED);BuyerOutboundNotificationCmd(RESCHEDULE);BuyerOutboundNotificationCmd(STATUS_CHANGE);BuyerCallbackNotificationCmd(RESCHEDULE_ACCEPT);updateServiceDateProcessVariableCmd();AlertCmd(emailProviderForAcceptReschedule)"/></field>
            </event-listener>
        </transition>
        <transition g="2016,519:5,-6" name="BUYER_REJECT_RESCHEDULE" to="Active">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="AlertCmd(emailProviderForRejectReschedule)"/></field>
            </event-listener>
        </transition>
        <transition  name="PROVIDER_REQUEST_RESCHEDULE" to="AutoAcceptCheckForProviderRescheduleinActive">
			<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
				<field name="commandList"><string value="RelayOutboundNotificationCmd(ORDER_RESCHEDULE_INITIATED_BY_PROVIDER);AlertCmd(emailBuyerForRescheduleRequest)"/></field>
 			</event-listener>
		</transition>
		<transition g="2011,548:7,-5" name="PROVIDER_CANCEL_RESCHEDULE" to="Active">
        	<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="AlertCmd(emailBuyerForCancelRescheduleRequest);RelayOutboundNotificationCmd(ORDER_RESCHEDULE_CANCELLED_BY_PROVIDER);"/></field>
            </event-listener>
        </transition>
        <transition g="1781,423;1644,425:-72,-16" name="PROVIDER_ACCEPT_RESCHEDULE" to="Accepted">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="UpdateLegacyStatusCmd(ACTIVE,ACCEPTED);BuyerOutboundNotificationCmd(RESCHEDULE);BuyerCallbackNotificationCmd(RESCHEDULE_ACCEPT);BuyerOutboundNotificationCmd(STATUS_CHANGE);updateServiceDateProcessVariableCmd();AlertCmd(emailBuyerForAcceptReschedule);RelayOutboundNotificationCmd(ORDER_RESCHEDULE_ACCEPTED_BY_PROVIDER);"/></field>
            </event-listener>
        </transition>
        <transition g="2008,562:9,-5" name="PROVIDER_REJECT_RESCHEDULE" to="Active">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="AlertCmd(emailBuyerForRejectReschedule);;RelayOutboundNotificationCmd(ORDER_RESCHEDULE_REJECTED_BY_PROVIDER);"/></field>
            </event-listener>
        </transition>
        <transition g="2016,463:7,-9" name="CANCEL_ORDER" to="Active">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SOLoggingCmd(requestCancellation);UpdateSubStatusCmd(CANCELLATION_REQUEST);CancellationRequestCmd();AlertCmd(emailForCancelActiveSO)"/></field>
            </event-listener>
        </transition>
        <transition g="2016,463:7,-9" name="SL_CANCEL_ORDER" to="TripChargeOverrideCheckInActive">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="CancellationRequestCmd();"/></field>
            </event-listener>
        </transition>
        <transition g="2016,463:7,-9" name="INTEGRATION_CANCEL_ORDER" to="IVREntryChckForActive">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value=""/></field>
            </event-listener>
        </transition>
        <transition g="-23,-54" name="INTEGRATION_CANCEL" to="Active">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="UpdateSubStatusCmd(NEEDS_ATTENTION);AlertCmd(emailForAssurantCancel);"/></field>
            </event-listener>
        </transition>
        <transition g="403,21:2,1" name="ACKNOWLEDGE_BATCH_UPDATE" to="Active">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SEARSHSR_SONoteCommand(HSRUpdate);UpdateSubStatusCmd(NEEDS_ATTENTION)"/></field>
            </event-listener>
        </transition>
        <transition g="1849,667;1738,747:-148,43" name="PROVIDER_REPORT_PROBLEM" to="Problem">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="UpdateLegacyStatusCmd(ACTIVE,PROBLEM);BuyerOutboundNotificationCmd(STATUS_CHANGE);UpdateProblemTypeCmd();AlertCmd(emailForProviderProblemReport)"/></field>
            </event-listener>
        </transition>

        <transition g="1886,669;1789,797:-187,45" name="BUYER_REPORT_PROBLEM" to="Problem">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="UpdateLegacyStatusCmd(ACTIVE, PROBLEM);BuyerOutboundNotificationCmd(STATUS_CHANGE);UpdateProblemTypeCmd();AlertCmd(emailForBuyerProblemReport)"/></field>
            </event-listener>
        </transition>
        <transition g="1890,68;1419,19;600,27:-162,2" name="PROVIDER_RELEASE_ORDER" to="RoutingBehaviourCheckForRelease">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                   <string value="UpdateLegacyStatusCmd(ACCEPTED,POSTED);updateServiceDateProcessVariableCmd();"/>
             </field>
            </event-listener>
        </transition>
        <transition g="1899,694;1205,782;31,790;26,455:17,-19" name="PROVIDER_FIRM_RELEASE_ORDER" to="RoutingBehaviourCheckForRelease">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="UpdateLegacyStatusCmd(ACCEPTED,POSTED);updateServiceDateProcessVariableCmd();"/>
                </field>
            </event-listener>
        </transition>
        <transition g="2000,452:6,-14" name="ON_SITE_VISIT" to="Active">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="RelayOutboundNotificationCmd(ORDER_CHECKED_IN_BY_PROVIDER);"/></field>
            </event-listener>
        </transition>
        <transition  name="MANAGE_SCOPE" to="IsAutoFundedForAddFundInActive"/>
        
        <transition g="1696,535:-43,2" name="CANCEL_ORDER_API" to="ProviderCompensationCheckForActive">
		    <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
				<field name="commandList"><string value="CancellationRequestCmd();"/></field>
	   		</event-listener>	       	    
		</transition>  
		 <transition g="2000,800:8,-9" name="UPDATE_BATCH_ORDER_SCOPE_CHANGED" to="TaskChangedCheckInActive" /> 
    </state>

    <decision name="IVREntryCheckForActive">
    <handler expr="#{IVREntryCheck}" />
    <transition name="withIVR" to="Active">
    		<event-listener	class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
    			<field name="commandList"><string value="SOLoggingCmd(requestCancellation);CancellationRequestCmd();UpdateSubStatusCmd(CANCELLATION_REQUEST);SEARSRI_SONoteCommand(WSCancel);SEARSHSR_SONoteCommand(HSRUpdate);AlertCmd(emailForCancelActiveSO)" /></field>
    		</event-listener>
    </transition>
    <transition name="withoutIVR" to="Cancelled">
    		<event-listener	class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
    			<field name="commandList"><string value="UpdateLegacyStatusCmd(ACTIVE,CANCELLED);UpdateSubStatusCmd(POS_CANCELLATIONS);BuyerOutboundNotificationCmd(STATUS_CHANGE);"/></field>
    		</event-listener>
    </transition>
    </decision>
	
	<decision name="IVREntryChckForActive">
    <handler expr="#{IVREntryCheck}" />
    <transition name="withIVR" to="Active">
    		<event-listener	class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
    			<field name="commandList"><string value="SEARSRI_SONoteCommand(SOUpdateNoChange,NEW_STATUS:ACTIVE);SEARSHSR_SONoteCommand(HSRUpdate);SOLoggingCmd(requestCancel,ACTIVE);CancellationRequestCmd();UpdatePOSIndicatorCmd();" /></field>
    		</event-listener>
    </transition>
    <transition name="withoutIVR" to="Cancelled">
    		<event-listener	class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
    			<field name="commandList"><string value="UpdateLegacyStatusCmd(ACTIVE,CANCELLED);UpdateSubStatusCmd(POS_CANCELLATIONS);BuyerOutboundNotificationCmd(STATUS_CHANGE);SEARSRI_SONoteCommand(WSCancelled,ACTIVE,CANCELLED);SOLoggingCmd(cancellingOrder,ACTIVE,CANCELLED);CancelWithNoPenaltyCmd();AlertCmd(emailForCancelAcceptedSO,pushAlertForAcceptedCancelledSO);AutoCancelCmd();" /></field>
    		</event-listener>
    </transition>
    </decision>
	
    <decision name="AutoAcceptCheckForProviderRescheduleinActive">
		<handler expr="#{autoAcceptCheck}" />
		<transition name="accept" to="Accepted">
			<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
				<field name="commandList"><string value="ScheduleUpdateCommand();UpdateLegacyStatusCmd(ACTIVE,ACCEPTED);BuyerOutboundNotificationCmd(SUB_STATUS_CHANGE);BuyerOutboundNotificationCmd(AUTO_ACCEPT);BuyerOutboundNotificationCmd(STATUS_CHANGE);SOLoggingCmd(buyerAcceptRescheduleLogging);updateServiceDateProcessVariableCmd();AlertCmd(emailProviderForAcceptReschedule);"/></field>
			</event-listener>
		</transition>
		<transition name="reject" to="Active">
			<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
				<field name="commandList"><string value="RescheduleNullCommand();SOLoggingCmd(buyerRejectRescheduleLogging);AlertCmd(emailProviderForRejectReschedule)"/></field>
			</event-listener>
		</transition>
		<transition name="noaction" to="Active">
			<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
				<field name="commandList"><string value="BuyerOutboundNotificationCmd(SUB_STATUS_CHANGE);"/></field>
			</event-listener>
		</transition>
	</decision>
	
	    <decision name="AutoAcceptCheckForBuyerRescheduleinActive">
		<handler expr="#{autoAcceptCheckBuyerReschedule}" />
		<transition name="true" to="Active">
			<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
				<field name="commandList"><string value="ScheduleUpdateCommand();SOLoggingCmd(buyerRescheduleAutoAcceptLogging);updateServiceDateProcessVariableCmd();AlertCmd(emailAutoAcceptBuyerRescheduleRequest);"/></field>
			</event-listener>
		</transition>
		<transition name="false" to="Active">
			<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
				<field name="commandList"><string value="AlertCmd(emailProviderForRescheduleRequest)"/></field>
			</event-listener>
		</transition>
	</decision>
	
	

	
	<decision name="AutoCloseBuyerFeatureCheckInActive">
        <handler expr="#{autoCloseBuyerFeatureCheck}" />
        <transition name="true" to="AutoCloseCheckInActive">
        <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
				<field name="commandList"><string value="CompleteOrderCmd();UpdateLegacyStatusCmd(ACTIVE,COMPLETED);BuyerOutboundNotificationCmd(STATUS_CHANGE);AlertCmd(emailForCompletedSO);AutoCloseRulesExecutionCmd();"/></field>
			</event-listener>
		</transition>	
        <transition name="false" to="Completed">
        <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="CompleteOrderCmd();UpdateLegacyStatusCmd(ACTIVE,COMPLETED);BuyerOutboundNotificationCmd(STATUS_CHANGE);AlertCmd(emailForCompletedSO);RelayOutboundNotificationCmd(ORDER_COMPLETED_BY_PROVIDER);"/></field>
            </event-listener>
            </transition>
            <transition name="cancelled" to="Cancelled">
        <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
    			<field name="commandList"><string value="SOLoggingCmd(serviceIncompleteLogging);UpdateLegacyStatusCmd(ACTIVE,CANCELLED);AlertCmd(emailForCancelAcceptedSO,pushAlertForAcceptedCancelledSO);UpdateSubStatusCmd(SERVICE_INCOMPLETE);BuyerOutboundNotificationCmd(STATUS_CHANGE);CancelWithNoPenaltyCmd();SOLoggingCmd(CancelSOWithoutPenalty);AutoCancelCmd();"/></field> 
            </event-listener>
            </transition>
            <transition name="autocloseHSR" to="AutoCloseCheckInActiveHSR">
			    <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
    			<field name="commandList"><string value="CompleteOrderCmd()"/></field> 
            	</event-listener>
            </transition>
     </decision>
	
	<decision name="AutoCloseCheckInActive">
        <handler expr="#{autoCloseCheck}"/>
       <transition name="true" to="CloseOrderReleaseFundsRequested">
        <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
    <field name="commandList"><string value="AutoCloseCmd();ValueLinkReconChkCmd();CloseOrderCmd();UpdateLegacyStatusCmd(COMPLETED,CLOSED);UpdateSubStatusCmd(AUTO_CLOSED);SOLoggingCmd(processAutoCloseSO);SOLoggingCmd(autoCloseSucessLogging);BuyerCallbackNotificationCmd(CLOSE_ORDER);"/></field> 
            </event-listener>
        </transition>
        <transition name="false" to="Completed">
        <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
    <field name="commandList"><string value="UpdateSubStatusCmd(NOT_AUTO_CLOSED);SOLoggingCmd(autoCloseFailureLogging);"/></field> 
            </event-listener>
            </transition>                        
     </decision>
	
	<decision name="AutoCloseCheckInActiveHSR">
        <handler expr="#{autoCloseCheckHSR}"/>
       <transition name="true" to="Completed">
        <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
    	<field name="commandList"><string value="UpdateLegacyStatusCmd(ACTIVE,COMPLETED);UpdateSubStatusCmd(AWAITING_PAYMENT);BuyerOutboundNotificationCmd(STATUS_CHANGE);AutoCloseHSRCmd();AlertCmd(emailForCompletedSO);"/></field> 
        </event-listener>
       </transition>
       <transition name="false" to="Completed">
        <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
    	<field name="commandList"><string value="UpdateLegacyStatusCmd(ACTIVE,COMPLETED);UpdateSubStatusCmd(AWAITING_PAYMENT);BuyerOutboundNotificationCmd(STATUS_CHANGE);AutoCloseHSRCmd();AlertCmd(emailForCompletedSO);"/></field> 
      	</event-listener>
       </transition>                        
     </decision>
		
    <decision name="LocationChangedCheckInActive">
        <handler expr="#{locationChangedCheck}" />
        <transition name="true" to="TaskChangedCheckInActive">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SONoteCommand(UpdateLocation);AlertCmd(changeOfLocation);"/></field>
            </event-listener>
        </transition>
        <transition name="false" to="TaskChangedCheckInActive"/>
    </decision>
    
	<decision name="TaskChangedCheckInActive">
        <handler expr="#{scopeChangedCheck}" />
        <transition name="true" to="OrderSpendLimitChangeCheckInActive">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="UpdateLegacyStatusCmd(ACTIVE,PROBLEM);UpdateSubStatusCmd(SCOPE_CHANGE);BuyerOutboundNotificationCmd(STATUS_CHANGE);AlertCmd(changeOfScope);SOLoggingCmd(problemScopeChangeLogging);"/></field>
            </event-listener>
        </transition>
        <transition name="false" to="Active"/>
    </decision>

    <decision g="308,392,38,48" name="OrderSpendLimitChangeCheckInActive">
        <handler expr="#{spendLimitChanged}" />
        <transition g="-53,-11" name="increase" to="IsAutoFundedForIncreaseInActive">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SOLoggingCmd(spendLimitUpdateLogging);"/></field>
            </event-listener>
        </transition>
        <transition g="-8,-11" name="decrease" to="Problem">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="DecreaseSpendingCmd();SOLoggingCmd(spendLimitUpdateLogging);"/></field>
            </event-listener>
        </transition>
        <transition g="-53,-35" name="noChange" to="Problem"/>
    </decision>
 
    <decision g="308,392,38,48" name="IsAutoFundedForIncreaseInActive">
        <handler expr="#{isAutoFunded}" />
        <transition g="-53,-11" name="true" to="Problem">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="IncreaseSpendingCmd();"/></field>
            </event-listener>
        </transition>
        <transition g="-8,-11" name="false" to="Problem"/>
    </decision>

    <decision g="1639,293,48,48" name="CancellationPenaltyCheck">
        <handler expr="#{cancellationPenaltyCheck}" />
        <transition g="-81,-9" name="CancelWithPenalty" to="CancellationPenaltyReleaseFundsRequested">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="CancelWithPenaltyCmd();SOLoggingCmd(CancelSOWithPenalty);AutoCancelCmd();"/></field>
            </event-listener>
        </transition>
        <transition g="-56,-1" name="CancelWithoutPenalty" to="Cancelled">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="CancelWithNoPenaltyCmd();SOLoggingCmd(CancelSOWithoutPenalty);AutoCancelCmd();"/></field>
            </event-listener>
        </transition>
    </decision>
    <decision g="1639,293,48,48" name="CancellationPenaltyCheckForPOSCancellation">
        <handler expr="#{cancellationPenaltyCheck}" />
        <transition g="-81,-9" name="CancelWithPenalty" to="Cancelled">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="ReversingSpendLimitCmd();SetPenaltyCmd();IncreasingSpendLimitCmd();ProviderReleasePaymentCmd();UpdateSubStatusCmd(POS_CANCELLATIONS);AutoCancelCmd();"/></field>
            </event-listener>
        </transition>
        <transition g="-56,-1" name="CancelWithoutPenalty" to="Cancelled">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="CancelWithNoPenaltyCmd();AutoCancelCmd();"/></field>
            </event-listener>
        </transition>
    </decision>        
     <decision g="1639,293,48,48" name="CancellationPenaltyCheckForAccepted">
        <handler expr="#{cancellationPenaltyCheck}" />
        <transition g="-81,-9" name="CancelWithPenalty" to="CancellationPenaltyReleaseFundsRequested">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="ReversingSpendLimitCmd();PriceUpdateCmd();SOLoggingCmd(CancelSOWithPenalty);IncreasingSpendLimitCmd();UpdateLegacyStatusCmd(ACCEPTED,CANCELLED);BuyerCallbackNotificationCmd(CANCEL_ORDER);BuyerOutboundNotificationCmd(STATUS_CHANGE);UpdateSOCancellationCmd(CANCEL);ProviderReleasePaymentCmd();AlertCmd(emailForCancelAcceptedSO,pushAlertForAcceptedCancelledSO);RelayOutboundNotificationCmd(ORDER_CANCELED_BY_CUSTOMER);"/></field>
            </event-listener>
        </transition>
        <transition g="-56,-1" name="CancelWithoutPenalty" to="Cancelled">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SOLoggingCmd(CancelSOWithoutPenalty);UpdateLegacyStatusCmd(ACCEPTED,CANCELLED);BuyerOutboundNotificationCmd(STATUS_CHANGE);UpdateSOCancellationCmd(CANCEL);ReversingSpendLimitCmd();PriceUpdateCmd();AlertCmd(emailForCancelAcceptedSO,pushAlertForAcceptedCancelledSO);RelayOutboundNotificationCmd(ORDER_CANCELED_BY_CUSTOMER);BuyerCallbackNotificationCmd(CANCEL_ORDER);"/></field>
            </event-listener>
        </transition>
    </decision>
    
     <decision g="1639,293,48,48" name="TripChargeOverrideCheckInAccepted">
        <handler expr="#{tripChargeOverrideCheck}" />
        <transition g="-81,-9" name="on" to="IsPayProviderCheckedForAccepted"/>
        <transition g="-56,-1" name="off" to="CancellationPenaltyCheckForAccepted"/>
    </decision>
    <decision g="1639,293,48,48" name="TripChargeOverrideCheckInActive">
        <handler expr="#{tripChargeOverrideCheck}" />
        <transition g="-81,-9" name="on" to="IsPayProviderCheckedForActive"/>
        <transition g="-56,-1" name="off" to="SoPricingMethodCheckForActive"/>
    </decision>
    <decision g="1639,293,48,48" name="TripChargeOverrideCheckInProblem">
        <handler expr="#{tripChargeOverrideCheck}" />
        <transition g="-81,-9" name="on" to="IsPayProviderCheckedForProblem"/>
        <transition g="-56,-1" name="off" to="SoPricingMethodCheckForProblem"/>
    </decision>
    
     <decision g="1639,293,48,48" name="IsPayProviderCheckedForAccepted">
        <handler expr="#{payProviderCheck}" />
        <transition g="-81,-9" name="on" to="SoPricingMethodCheckForAccepted"/>
        <transition g="-56,-1" name="off" to="Cancelled">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SOLoggingCmd(CancelSOWithoutPenalty);UpdateLegacyStatusCmd(ACCEPTED,CANCELLED);BuyerOutboundNotificationCmd(STATUS_CHANGE);UpdateSOCancellationCmd(CANCEL);ReversingSpendLimitCmd();PriceUpdateCmd();AlertCmd(emailForCancelAcceptedSO,pushAlertForAcceptedCancelledSO);RelayOutboundNotificationCmd(ORDER_CANCELED_BY_CUSTOMER);BuyerCallbackNotificationCmd(CANCEL_ORDER);"/></field>
            </event-listener>
        </transition>
        <transition g="-56,-1" name="nonfunded" to="Cancelled">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SOLoggingCmd(CancelSOWithoutPenalty);UpdateLegacyStatusCmd(ACCEPTED,CANCELLED);BuyerOutboundNotificationCmd(STATUS_CHANGE);UpdateSOCancellationCmd(CANCEL);ReversingSpendLimitCmd();PriceUpdateCmd();AlertCmd(emailForCancelAcceptedSO,pushAlertForAcceptedCancelledSO);BuyerCallbackNotificationCmd(CANCEL_ORDER);"/></field>
            </event-listener>
        </transition>
    </decision>
    
     <decision g="1639,293,48,48" name="IsPayProviderCheckedForActive">
        <handler expr="#{payProviderCheck}" />
        <transition g="-81,-9" name="on" to="SoPricingMethodCheckForActive"/>
        <transition g="-56,-1" name="off" to="Cancelled">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SOLoggingCmd(CancelSOWithoutPenalty);UpdateLegacyStatusCmd(ACTIVE,CANCELLED);BuyerOutboundNotificationCmd(STATUS_CHANGE);UpdateSOCancellationCmd(CANCEL);ReversingSpendLimitCmd();PriceUpdateCmd();AlertCmd(emailForCancelAcceptedSO,pushAlertForAcceptedCancelledSO);RelayOutboundNotificationCmd(ORDER_CANCELED_BY_CUSTOMER);"/></field>
            </event-listener>
        </transition>
         <transition g="-56,-1" name="nonfunded" to="Cancelled">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SOLoggingCmd(CancelSOWithoutPenalty);UpdateLegacyStatusCmd(ACTIVE,CANCELLED);BuyerOutboundNotificationCmd(STATUS_CHANGE);UpdateSOCancellationCmd(CANCEL);ReversingSpendLimitCmd();PriceUpdateCmd();AlertCmd(emailForCancelAcceptedSO,pushAlertForAcceptedCancelledSO);"/></field>
            </event-listener>
        </transition>
    </decision>
    
     <decision g="1639,293,48,48" name="IsPayProviderCheckedForProblem">
        <handler expr="#{payProviderCheck}" />
        <transition g="-81,-9" name="on" to="SoPricingMethodCheckForProblem"/>
        <transition g="-56,-1" name="off" to="Cancelled">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SOLoggingCmd(CancelSOWithoutPenalty);UpdateLegacyStatusCmd(PROBLEM,CANCELLED);BuyerOutboundNotificationCmd(STATUS_CHANGE);UpdateSOCancellationCmd(CANCEL);ReversingSpendLimitCmd();PriceUpdateCmd();AlertCmd(emailForCancelAcceptedSO,pushAlertForAcceptedCancelledSO);RelayOutboundNotificationCmd(ORDER_CANCELED_BY_CUSTOMER);"/></field>
            </event-listener>
        </transition>
        <transition g="-56,-1" name="nonfunded" to="Cancelled">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SOLoggingCmd(CancelSOWithoutPenalty);UpdateLegacyStatusCmd(PROBLEM,CANCELLED);BuyerOutboundNotificationCmd(STATUS_CHANGE);UpdateSOCancellationCmd(CANCEL);ReversingSpendLimitCmd();PriceUpdateCmd();AlertCmd(emailForCancelAcceptedSO,pushAlertForAcceptedCancelledSO)"/></field>
            </event-listener>
        </transition>
    </decision>
    
     <decision g="1639,293,48,48" name="SoPricingMethodCheckForAccepted">
        <handler expr="#{soPricingMethodCheck}" />
        <transition g="-81,-9" name="soLevel" to="PendingCancel">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="ReversingSpendLimitCmd();SOLoggingCmd(pendingCancelLogging);UpdateLegacyStatusCmd(ACCEPTED,PENDINGCANCEL);UpdateSOCancellationCmd(PENDINGCANCEL);AlertCmd(emailForPendingCancelSO);UpdatePendingCancelHistoryCmd();PriceUpdateForPndngCnclCmd();IncreasingSpendLimitCmd();"/></field>
            </event-listener>
        </transition>
        <transition g="-56,-1" name="taskLevel" to="ProviderVerbalAcknowledgmentCheckForAccepted"/>
                 <transition g="-56,-1" name="nonfunded" to="Cancelled">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SOLoggingCmd(CancelSOWithoutPenalty);UpdateLegacyStatusCmd(ACCEPTED,CANCELLED);UpdateSOCancellationCmd(CANCEL);ReversingSpendLimitCmd();PriceUpdateCmd();AlertCmd(emailForCancelAcceptedSO,pushAlertForAcceptedCancelledSO);BuyerCallbackNotificationCmd(CANCEL_ORDER);"/></field>
            </event-listener>
        </transition>
     </decision>
    
      <decision g="1639,293,48,48" name="SoPricingMethodCheckForActive">
        <handler expr="#{soPricingMethodCheck}" />
        <transition g="-81,-9" name="soLevel" to="PendingCancel">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="ReversingSpendLimitCmd();SOLoggingCmd(pendingCancelLogging);UpdateLegacyStatusCmd(ACTIVE,PENDINGCANCEL);UpdateSOCancellationCmd(PENDINGCANCEL);AlertCmd(emailForPendingCancelSO);UpdatePendingCancelHistoryCmd();PriceUpdateForPndngCnclCmd();IncreasingSpendLimitCmd();"/></field>
            </event-listener>
        </transition>
        <transition g="-56,-1" name="taskLevel" to="ProviderVerbalAcknowledgmentCheckForActive"/>
         <transition g="-56,-1" name="nonfunded" to="Cancelled">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SOLoggingCmd(CancelSOWithoutPenalty);UpdateLegacyStatusCmd(ACTIVE,CANCELLED);UpdateSOCancellationCmd(CANCEL);ReversingSpendLimitCmd();PriceUpdateCmd();AlertCmd(emailForCancelAcceptedSO,pushAlertForAcceptedCancelledSO);"/></field>
            </event-listener>
        </transition>
      </decision>
    
     <decision g="1639,293,48,48" name="SoPricingMethodCheckForProblem">
        <handler expr="#{soPricingMethodCheck}" />
        <transition g="-81,-9" name="soLevel" to="PendingCancel">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="ReversingSpendLimitCmd();SOLoggingCmd(pendingCancelLogging);UpdateLegacyStatusCmd(PROBLEM,PENDINGCANCEL);AlertCmd(emailForPendingCancelSO);UpdatePendingCancelHistoryCmd();PriceUpdateForPndngCnclCmd();IncreasingSpendLimitCmd();"/></field>
            </event-listener>
        </transition>
        <transition g="-56,-1" name="taskLevel" to="ProviderVerbalAcknowledgmentCheckForProblem"/>
         <transition g="-56,-1" name="nonfunded" to="Cancelled">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SOLoggingCmd(CancelSOWithoutPenalty);UpdateLegacyStatusCmd(PROBLEM,CANCELLED);UpdateSOCancellationCmd(CANCEL);ReversingSpendLimitCmd();PriceUpdateCmd();AlertCmd(emailForCancelAcceptedSO,pushAlertForAcceptedCancelledSO)"/></field>
            </event-listener>
        </transition>
    </decision>
    
    <decision g="1639,293,48,48" name="ProviderVerbalAcknowledgmentCheckForAccepted">
        <handler expr="#{providerVerbalAcknowledgmentCheck}" />
        <transition g="-81,-9" name="true" to="CancellationPenaltyReleaseFundsRequested">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SOLoggingCmd(scopeChangeCancelLogging);UpdateLegacyStatusCmd(ACCEPTED,CANCELLED);BuyerOutboundNotificationCmd(STATUS_CHANGE);UpdateSOCancellationCmd(CANCEL);SOLoggingCmd(CancelSOWithPenalty);ReversingSpendLimitCmd();PriceUpdateCmd();IncreasingSpendLimitCmd();ProviderReleasePaymentCmd();AlertCmd(emailForCancelAcceptedSO,pushAlertForAcceptedCancelledSO);RelayOutboundNotificationCmd(ORDER_CANCELED_BY_CUSTOMER);BuyerCallbackNotificationCmd(CANCEL_ORDER);"/></field>
            </event-listener>
        </transition>
        <transition g="-56,-1" name="false" to="PendingCancel">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="ReversingSpendLimitCmd();SOLoggingCmd(scopeChangeCancelLogging);UpdateLegacyStatusCmd(ACCEPTED,PENDINGCANCEL);UpdateSOCancellationCmd(PENDINGCANCEL);SOLoggingCmd(pendingCancelLogging);AlertCmd(emailForPendingCancelSO);UpdatePendingCancelHistoryCmd();PriceUpdateForPndngCnclCmd();IncreasingSpendLimitCmd();"/></field>
            </event-listener>
        </transition>
    </decision>
    
     <decision g="1639,293,48,48" name="ProviderVerbalAcknowledgmentCheckForActive">
        <handler expr="#{providerVerbalAcknowledgmentCheck}" />
        <transition g="-81,-9" name="true" to="CancellationPenaltyReleaseFundsRequested">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SOLoggingCmd(scopeChangeCancelLogging);UpdateLegacyStatusCmd(ACTIVE,CANCELLED);BuyerOutboundNotificationCmd(STATUS_CHANGE);UpdateSOCancellationCmd(CANCEL);SOLoggingCmd(CancelSOWithPenalty);ReversingSpendLimitCmd();PriceUpdateCmd();IncreasingSpendLimitCmd();ProviderReleasePaymentCmd();AlertCmd(emailForCancelAcceptedSO,pushAlertForAcceptedCancelledSO);RelayOutboundNotificationCmd(ORDER_CANCELED_BY_CUSTOMER);"/></field>
            </event-listener>
        </transition>
        <transition g="-56,-1" name="false" to="PendingCancel">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="ReversingSpendLimitCmd();SOLoggingCmd(scopeChangeCancelLogging);UpdateLegacyStatusCmd(ACTIVE,PENDINGCANCEL);UpdateSOCancellationCmd(PENDINGCANCEL);SOLoggingCmd(pendingCancelLogging);AlertCmd(emailForPendingCancelSO);UpdatePendingCancelHistoryCmd();PriceUpdateForPndngCnclCmd();IncreasingSpendLimitCmd();"/></field>
            </event-listener>
        </transition>
    </decision>
    
     <decision g="1639,293,48,48" name="ProviderVerbalAcknowledgmentCheckForProblem">
        <handler expr="#{providerVerbalAcknowledgmentCheck}" />
        <transition g="-81,-9" name="true" to="CancellationPenaltyReleaseFundsRequested">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SOLoggingCmd(scopeChangeCancelLogging);UpdateLegacyStatusCmd(PROBLEM,CANCELLED);BuyerOutboundNotificationCmd(STATUS_CHANGE);UpdateSOCancellationCmd(CANCEL);SOLoggingCmd(CancelSOWithPenalty);ReversingSpendLimitCmd();PriceUpdateCmd();IncreasingSpendLimitCmd();ProviderReleasePaymentCmd();AlertCmd(emailForCancelAcceptedSO,pushAlertForAcceptedCancelledSO);RelayOutboundNotificationCmd(ORDER_CANCELED_BY_CUSTOMER);"/></field>
            </event-listener>
        </transition>
        <transition g="-56,-1" name="false" to="PendingCancel">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="ReversingSpendLimitCmd();SOLoggingCmd(scopeChangeCancelLogging);UpdateLegacyStatusCmd(PROBLEM,PENDINGCANCEL);UpdateSOCancellationCmd(PENDINGCANCEL);SOLoggingCmd(pendingCancelLogging);AlertCmd(emailForPendingCancelSO);UpdatePendingCancelHistoryCmd();PriceUpdateForPndngCnclCmd();IncreasingSpendLimitCmd();"/></field>
            </event-listener>
        </transition>
    </decision>
    
 	<decision g="308,392,38,48" name="ProviderCompensationCheckForActive">
        <handler expr="#{payProviderCheck}" />
        <transition g="-81,-9" name="on" to="ProviderAcknowledgementCheckForActive"/>
        <transition g="-56,-1" name="off" to="CancellationPenaltyReleaseFundsRequested">
			<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
				<field name="commandList">
					<string value="UpdateLegacyStatusCmd(ACTIVE,CANCELLED);BuyerOutboundNotificationCmd(STATUS_CHANGE);UpdateSOCancellationCmd(CANCEL);SOLoggingCmd(CancelSOWithPenalty);
						ReversingSpendLimitCmd();PriceUpdateCmd();IncreasingSpendLimitCmd();ProviderReleasePaymentCmd();AlertCmd(emailForCancelAcceptedSO,pushAlertForAcceptedCancelledSO);RelayOutboundNotificationCmd(ORDER_CANCELED_BY_CUSTOMER);"/>
				</field>
			</event-listener>
		</transition>
		<transition g="-56,-1" name="nonfunded" to="Cancelled">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SOLoggingCmd(CancelSOWithoutPenalty);UpdateLegacyStatusCmd(ACTIVE,CANCELLED);UpdateSOCancellationCmd(CANCEL);ReversingSpendLimitCmd();PriceUpdateCmd();AlertCmd(emailForCancelAcceptedSO,pushAlertForAcceptedCancelledSO)"/></field>
            </event-listener>
        </transition>
    </decision>   

    <decision g="308,392,38,48" name="ProviderAcknowledgementCheckForActive">
        <handler expr="#{providerVerbalAcknowledgmentCheck}" />
        <transition g="-81,-9" name="true" to="CancellationPenaltyReleaseFundsRequested">
			<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
				<field name="commandList">
					<string value="UpdateLegacyStatusCmd(ACTIVE,CANCELLED);BuyerOutboundNotificationCmd(STATUS_CHANGE);UpdateSOCancellationCmd(CANCEL);SOLoggingCmd(CancelSOWithPenalty);
							ReversingSpendLimitCmd();PriceUpdateCmd();IncreasingSpendLimitCmd();ProviderReleasePaymentCmd();AlertCmd(emailForCancelAcceptedSO,pushAlertForAcceptedCancelledSO);RelayOutboundNotificationCmd(ORDER_CANCELED_BY_CUSTOMER);"/>
				</field>
			</event-listener>
		</transition>
        <transition g="-56,-1" name="false" to="PendingCancel">
			<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
				<field name="commandList">
					<string value="ReversingSpendLimitCmd();UpdateLegacyStatusCmd(ACTIVE,PENDINGCANCEL);UpdateSOCancellationCmd(PENDINGCANCEL);
							SOLoggingCmd(pendingCancelLogging);AlertCmd(emailForPendingCancelSO);UpdatePendingCancelHistoryCmd();PriceUpdateForPndngCnclCmd();IncreasingSpendLimitCmd();"/>
				</field>
			</event-listener>
		</transition>
    </decision>
    
    
    <script g="165,486,196,52" name="CancellationPenaltyReleaseFundsRequested" expr="0" var="loopCounter">
        <transition g="383,557:-61,-13" name="CancellationPenaltyReleaseFundsCheckTimer" to="CancellationPenaltyReleaseFundsCheckTimer"/>
    </script>

    <state g="1030,723,197,40" name="CancellationPenaltyReleaseFundsCheckTimer">
        <transition g="1046,713;1046,688:-79,-11" name="CancellationPenaltyReleaseFundsLoopCheck" to="CancellationPenaltyReleaseFundsLoopCheck">
            <timer duedate="10 seconds"/>
            <script name="incrementLoopCounter"
                expr="#{loopCounter + 1}" var="loopCounter">
            </script>
        </transition>
        <transition name="ADMIN_CANCEL_PENDING_TRANSACTION" to="CancellationPenaltyActivity">
        	<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="UpdateSubStatusCmd(NULL);ClearJmsMessageIdCmd();"/>
                </field>
            </event-listener>
        </transition>
    </state>

    <decision name="CancellationPenaltyReleaseFundsLoopCheck">
        <transition to="CancellationPenaltyReleaseFundsCheck" >
            <condition expr="#{loopCounter == 3}"/>
            <event-listener
                class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="RecordJmsMessageIdCmd();UpdateSubStatusCmd(PENDING_WALLET_CONFIRMATION);AlertCmd(emailForWalletRequestTimeout);"/></field>
               </event-listener>
        </transition>
        <transition name="Default" to="CancellationPenaltyReleaseFundsCheck"/>
    </decision>

    <decision g="410,470,48,48" name="CancellationPenaltyReleaseFundsCheck">
        <handler expr="#{fundsConfirmedCheck}" />
        <transition g="200,418:-26,-7" name="Wait" to="CancellationPenaltyReleaseFundsCheckTimer"/>
        <transition g="28,94" name="Fail" to="CancellationPenaltyActivity">
        	<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="UpdateSubStatusCmd(NULL);ClearJmsMessageIdCmd();"/>
                </field>
            </event-listener>
        </transition>
        <transition g="-17,-1" name="Success" to="CancellationPenaltyActivity">
        	<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="UpdateSubStatusCmd(NULL);ClearJmsMessageIdCmd();"/>
                </field>
            </event-listener>
        </transition>
    </decision>
    
    <custom name="CancellationPenaltyActivity" class="com.servicelive.orderfulfillment.node.DefaultCustomActivity" continue="async">
        <transition g="-43,-8" to="Cancelled">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="GetWalletCancelPenaltyInfoCmd();AlertCmd(emailForBuyerCancelWithPenalty,emailForProviderCancelWithPenalty);"/></field>
            </event-listener>
        </transition>
    </custom>
	
	
    <state g="1857,762,92,52" name="Completed">
        <on event="start">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="FireEventCmd(COMPLETED);ASN_MarkOrderNotUpdatable();RemoveFieldsCmd(MainJobCode,ServiceOrderChanges,loopCounter,jmsMessageId,walletMessageId,ledgerPostingFee,ledgerSpendLimitRsrvTransactionId,fundsConfirmedTransactionId,ledgerSpendLimitRsrvAmt,ledgerPostTransactionId,PVKey_Comment);"/>
                </field>
            </event-listener>
        </on>
        <transition g="2000,800:8,-8" name="UPDATE_BATCH_ORDER_SCOPE_CHANGED" to="TaskChangedCheckInCompleted" />
        <transition g="-26,-12" name="CLOSE_ORDER" to="CloseOrderReleaseFundsRequested">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                	<string value="ValueLinkReconChkCmd();CloseOrderCmd();UpdateLegacyStatusCmd(COMPLETED,CLOSED);BuyerCallbackNotificationCmd(CLOSE_ORDER);"/>
                </field>
            </event-listener>
        </transition>
         <transition g="-26,-12" name="HSR_AUTO_CLOSE_ORDER" to="CloseOrderReleaseFundsRequested">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                	<string value="ValueLinkReconChkCmd();CloseOrderCmd();UpdateLegacyStatusCmd(COMPLETED,CLOSED);UpdateSubStatusCmd(AUTO_CLOSED);SOLoggingCmd(hsrAutoCloseSucessLogging);BuyerCallbackNotificationCmd(CLOSE_ORDER);"/>
                </field>
            </event-listener>
        </transition> 
        
        <transition g="1943,671;1948,621:-64,37" name="RECALL_COMPLETION" to="Active">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="RecallCompletionCmd();UpdateLegacyStatusCmd(COMPLETED,ACTIVE);BuyerOutboundNotificationCmd(STATUS_CHANGE);"/></field>
            </event-listener>
        </transition>

        <transition g="1814,837;1691,839:-76,-1" name="PROVIDER_REPORT_PROBLEM" to="Problem">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="UpdateLegacyStatusCmd(COMPLETED,PROBLEM);BuyerOutboundNotificationCmd(STATUS_CHANGE);UpdateProblemTypeCmd();AlertCmd(emailForProviderProblemReport)"/></field>
            </event-listener>
        </transition>

        <transition g="1821,857;1692,859:-75,0" name="BUYER_REPORT_PROBLEM" to="Problem">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="UpdateLegacyStatusCmd(COMPLETED,PROBLEM);BuyerOutboundNotificationCmd(STATUS_CHANGE);UpdateProblemTypeCmd();AlertCmd(emailForBuyerProblemReport)"/></field>
            </event-listener>
        </transition>
        <transition g="403,21:2,1" name="ACKNOWLEDGE_BATCH_UPDATE" to="Completed">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SEARSHSR_SONoteCommand(HSRUpdate);UpdateSubStatusCmd(NEEDS_ATTENTION)"/></field>
            </event-listener>
        </transition>
        
        <transition g="1450,506:-68,-14" name="UPDATE_ORDER" to="Completed"/> 
        
    </state>
    
    <decision name="TaskChangedCheckInCompleted">
	        <handler expr="#{scopeChangedCheck}" />
	        <transition name="true" to="OrderSpendLimitChangeCheckInCompleted">
	            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
	                <field name="commandList"><string value="UpdateLegacyStatusCmd(COMPLETED,PROBLEM);UpdateSubStatusCmd(SCOPE_CHANGE);BuyerOutboundNotificationCmd(STATUS_CHANGE);AlertCmd(changeOfScope);SOLoggingCmd(problemScopeChangeLogging);"/></field>
	            </event-listener>
	        </transition>
	        <transition name="false" to="Completed"/>
	 </decision>
    
	 <decision name="OrderSpendLimitChangeCheckInCompleted">
	        <handler expr="#{spendLimitChanged}" />
	        <transition name="increase" to="IsAutoFundedForIncreaseInCompleted">
	            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
	                <field name="commandList"><string value="SOLoggingCmd(spendLimitUpdateLogging);"/></field>
	            </event-listener>
	        </transition>
	        <transition name="decrease" to="Problem">
	            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
	                <field name="commandList"><string value="DecreaseSpendingCmd();SOLoggingCmd(spendLimitUpdateLogging);"/></field>
	            </event-listener>
	        </transition>
	        <transition name="noChange" to="Problem"/>
	  </decision>
 	  <decision name="IsAutoFundedForIncreaseInCompleted">
	         <handler expr="#{isAutoFunded}" />
	         <transition name="true" to="Problem">
	             <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
	                 <field name="commandList"><string value="IncreaseSpendingCmd();"/></field>
	             </event-listener>
	         </transition>
	         <transition name="false" to="Problem"/>
    	</decision>
    
    <script g="165,486,196,52" name="CloseOrderReleaseFundsRequested" expr="0" var="loopCounter">
        <transition g="383,557:-61,-13" name="CloseOrderReleaseFundsCheckTimer" to="CloseOrderReleaseFundsCheckTimer"/>
    </script>

    <state g="1030,723,197,40" name="CloseOrderReleaseFundsCheckTimer">
        <transition g="1046,713;1046,688:-79,-11" name="CloseOrderReleaseFundsLoopCheck" to="CloseOrderReleaseFundsLoopCheck">
            <timer duedate="10 seconds"/>
            <script name="incrementLoopCounter"
                expr="#{loopCounter + 1}" var="loopCounter">
            </script>
        </transition>
        <transition name="ADMIN_CANCEL_PENDING_TRANSACTION" to="AlertActivityClose">
        	<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="UpdateSubStatusCmd(NULL);ClearJmsMessageIdCmd();"/>
                </field>
            </event-listener>
        </transition>
    </state>

    <decision name="CloseOrderReleaseFundsLoopCheck">
        <transition to="CloseOrderReleaseFundsCheck" >
            <condition expr="#{loopCounter == 3}"/>
            <event-listener
                class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="RecordJmsMessageIdCmd();UpdateSubStatusCmd(PENDING_WALLET_CONFIRMATION);AlertCmd(emailForWalletRequestTimeout);"/></field>
               </event-listener>
        </transition>
        <transition name="Default" to="CloseOrderReleaseFundsCheck"/>
    </decision>

    <decision g="410,470,48,48" name="CloseOrderReleaseFundsCheck">
        <handler expr="#{fundsConfirmedCheck}" />
        <transition g="200,418:-26,-7" name="Wait" to="CloseOrderReleaseFundsCheckTimer"/>
        <transition g="28,94" name="Fail" to="AlertActivityClose">
        	<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="UpdateSubStatusCmd(NULL);ClearJmsMessageIdCmd();"/>
                </field>
            </event-listener>
        </transition>
        <transition g="-17,-1" name="Success" to="AlertActivityClose">
        	<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="UpdateSubStatusCmd(NULL);ClearJmsMessageIdCmd();"/>
                </field>
            </event-listener>
        </transition>
        <transition  name="autoClose" to="AlertActivityClose">
        	<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="UpdateSubStatusCmd(AUTO_CLOSED);ClearJmsMessageIdCmd();"/>
                </field>
            </event-listener>
        </transition>
    </decision>
    
    <custom name="AlertActivityClose" class="com.servicelive.orderfulfillment.node.DefaultCustomActivity">
        <transition to="Closed">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="GetWalletCloseInfoCmd();AlertCmd(emailBuyerForCloseSO);AlertCmd(emailProviderForCloseSO);"/></field>
            </event-listener>
        </transition>
    </custom>

    <state g="1503,779,89,50" name="Problem">
        <on event="start">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="FireEventCmd(PROBLEM);RemoveFieldsCmd(MainJobCode,ServiceOrderChanges,loopCounter,jmsMessageId,walletMessageId,ledgerPostingFee,ledgerSpendLimitRsrvTransactionId,fundsConfirmedTransactionId,ledgerSpendLimitRsrvAmt,ledgerPostTransactionId,PVKey_Comment);"/>
                </field>
            </event-listener>
        </on>
        <transition g="2016,463:7,-9" name="SL_CANCEL_ORDER" to="TripChargeOverrideCheckInProblem"/>
        <transition g="1581,954:9,-7" name="PROVIDER_REPORT_PROBLEM" to="Problem">
        	<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="UpdateProblemTypeCmd();"/>
                </field>
            </event-listener>
        </transition>
        <transition g="1597,939:4,-3" name="BUYER_REPORT_PROBLEM" to="Problem">
        	<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="UpdateProblemTypeCmd();"/>
                </field>
            </event-listener>
        </transition>
		<transition g="650,360;650,459:-182,214" name="UPDATE_BATCH_ORDER" to="LocationChangedCheckInProblem"/>
        <transition g="-57,-1" name="PROVIDER_RESOLVE_PROBLEM" to="FromProblemToActivateCheck"/>
        <transition g="1709,695:-98,2" name="BUYER_RESOLVE_PROBLEM" to="FromProblemToActivateCheck"/>            
        <transition g="11,818;8,451:7,163" name="PROVIDER_RELEASE_ORDER" to="RoutingBehaviourCheckForRelease">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="UpdateLegacyStatusCmd(ACCEPTED,POSTED);updateServiceDateProcessVariableCmd();"/>
                </field>
            </event-listener>
        </transition>
        <transition g="1111,694;1205,782;31,790;26,455:17,-19" name="PROVIDER_FIRM_RELEASE_ORDER" to="RoutingBehaviourCheckForRelease">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="UpdateLegacyStatusCmd(ACCEPTED,POSTED);updateServiceDateProcessVariableCmd();"/>
                </field>
            </event-listener>
        </transition>
        <transition g="1614,907:4,3" name="BUYER_REQUEST_RESCHEDULE" to="AutoAcceptCheckForBuyerRescheduleinProblem">
        </transition>
        <transition g="1447,836:-164,-2" name="BUYER_CANCEL_RESCHEDULE" to="Problem">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="AlertCmd(emailProviderForCancelRescheduleRequest)"/></field>
            </event-listener>            
        </transition>
        <transition g="1444,883:-163,-9" name="BUYER_ACCEPT_RESCHEDULE" to="Problem">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="BuyerOutboundNotificationCmd(RESCHEDULE);AlertCmd(emailProviderForAcceptReschedule)"/></field>
            </event-listener>
        </transition>
        <transition g="1445,853:-157,-5" name="BUYER_REJECT_RESCHEDULE" to="Problem">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="AlertCmd(emailProviderForRejectReschedule)"/></field>
            </event-listener>
        </transition>
        <transition g="1607,919:-2,4" name="PROVIDER_REQUEST_RESCHEDULE" to="Problem">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="RelayOutboundNotificationCmd(ORDER_RESCHEDULE_INITIATED_BY_PROVIDER);AlertCmd(emailBuyerForRescheduleRequest);"/></field>
            </event-listener>
        </transition>
        <transition g="1451,822:-184,-1" name="PROVIDER_CANCEL_RESCHEDULE" to="Problem">
        	<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="AlertCmd(emailBuyerForCancelRescheduleRequest);RelayOutboundNotificationCmd(ORDER_RESCHEDULE_CANCELLED_BY_PROVIDER);"/></field>
            </event-listener>
        </transition>
        <transition g="1457,898:-180,-8" name="PROVIDER_ACCEPT_RESCHEDULE" to="Problem">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="BuyerOutboundNotificationCmd(RESCHEDULE);AlertCmd(emailBuyerForAcceptReschedule);RelayOutboundNotificationCmd(ORDER_RESCHEDULE_ACCEPTED_BY_PROVIDER);"/></field>
            </event-listener>
        </transition>
        <transition g="1446,867:-174,-6" name="PROVIDER_REJECT_RESCHEDULE" to="Problem">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="AlertCmd(emailBuyerForRejectReschedule);RelayOutboundNotificationCmd(ORDER_RESCHEDULE_REJECTED_BY_PROVIDER);"/></field>
            </event-listener>
        </transition>
        <transition g="1449,815:-67,-7" name="ADD_FUND" to="IsAutoFundedForAddFundInProblem">
        	<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SpendLimitHistoryUpdateCmd();RelayOutboundNotificationCmd(ORDER_SPENDLIMIT_UPDATE_FROM_FRONTEND)"/></field>
            </event-listener>
        </transition>
        
        <transition g="1450,506:-68,-14" name="UPDATE_ORDER" to="IsSpendLimitIncreasedForProblem"/>    
         
        <transition g="-23,-54" name="INTEGRATION_CANCEL_ORDER" to="IVREntryChckForProblem" >
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value=""/></field>
            </event-listener>
        </transition>
        <transition g="-23,-54" name="INTEGRATION_CANCEL" to="Problem">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="UpdateSubStatusCmd(NEEDS_ATTENTION);ASN_AlertCmd(emailForAssurantCancel);"/></field>
            </event-listener>
        </transition>
        <transition g="403,21:2,1" name="ACKNOWLEDGE_BATCH_UPDATE" to="Problem">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SEARSHSR_SONoteCommand(HSRUpdate);UpdateSubStatusCmd(NEEDS_ATTENTION)"/></field>
            </event-listener>
        </transition>
        <transition  name="MANAGE_SCOPE" to="IsAutoFundedForAddFundInProblem"/>
        <transition g="1696,535:-43,2" name="CANCEL_ORDER_API" to="ProviderCompensationCheckForProblem"/>
    </state>
    
    
    <decision name="AutoAcceptCheckForBuyerRescheduleinProblem">
	<handler expr="#{autoAcceptCheckBuyerReschedule}" />
	<transition name="true" to="Problem">
 		<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
			<field name="commandList"><string value="ScheduleUpdateCommand();SOLoggingCmd(buyerRescheduleAutoAcceptLogging);updateServiceDateProcessVariableCmd();AlertCmd(emailAutoAcceptBuyerRescheduleRequest);"/></field>
 		</event-listener>
	</transition>
	<transition name="false" to="Problem">
		<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                    <field name="commandList"><string value="AlertCmd(emailProviderForRescheduleRequest)"/></field>
		</event-listener>
	</transition>
	</decision>
    
    
	<decision name="IVREntryCheckForProblem">
	<handler expr="#{IVREntryCheck}" />
	<transition name="withIVR" to="Problem">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SEARSRI_SONoteCommand(WSCancel);SEARSHSR_SONoteCommand(HSRUpdate);"/></field>
            </event-listener>
	</transition>	
	<transition name="withoutIVR" to="Cancelled">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="UpdateLegacyStatusCmd(PROBLEM,CANCELLED);UpdateSubStatusCmd(POS_CANCELLATIONS);BuyerOutboundNotificationCmd(STATUS_CHANGE);"/></field>
            </event-listener>
	</transition>
	</decision>	
	
	<decision name="IVREntryChckForProblem">
	<handler expr="#{IVREntryCheck}" />
	<transition name="withIVR" to="Problem">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SEARSRI_SONoteCommand(SOUpdateNoChange,NEW_STATUS:PROBLEM);SEARSHSR_SONoteCommand(HSRUpdate);SOLoggingCmd(requestCancel,PROBLEM);UpdatePOSIndicatorCmd();"/></field>
            </event-listener>
	</transition>	
	<transition name="withoutIVR" to="Cancelled">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="UpdateLegacyStatusCmd(PROBLEM,CANCELLED);UpdateSubStatusCmd(POS_CANCELLATIONS);BuyerOutboundNotificationCmd(STATUS_CHANGE);SEARSRI_SONoteCommand(WSCancelled,PROBLEM,CANCELLED);SOLoggingCmd(cancellingOrder,PROBLEM,CANCELLED);CancelWithNoPenaltyCmd();AlertCmd(emailForCancelAcceptedSO,pushAlertForAcceptedCancelledSO);AutoCancelCmd();"/></field>
            </event-listener>
	</transition>
	 </decision>
	 
	 <decision g="308,392,38,48" name="ProviderCompensationCheckForProblem">
        <handler expr="#{payProviderCheck}" />
        <transition g="-81,-9" name="on" to="ProviderAcknowledgementCheckForProblem"/>
        <transition g="-56,-1" name="off" to="CancellationPenaltyReleaseFundsRequested">
			<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
				<field name="commandList">
					<string value="UpdateLegacyStatusCmd(PROBLEM,CANCELLED);BuyerOutboundNotificationCmd(STATUS_CHANGE);UpdateSOCancellationCmd(CANCEL);SOLoggingCmd(CancelSOWithPenalty);
							ReversingSpendLimitCmd();PriceUpdateCmd();IncreasingSpendLimitCmd();ProviderReleasePaymentCmd();AlertCmd(emailForCancelAcceptedSO,pushAlertForAcceptedCancelledSO);RelayOutboundNotificationCmd(ORDER_CANCELED_BY_CUSTOMER);"/>
				</field>
			</event-listener>
		</transition>
		<transition g="-56,-1" name="nonfunded" to="Cancelled">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SOLoggingCmd(CancelSOWithoutPenalty);UpdateLegacyStatusCmd(PROBLEM,CANCELLED);UpdateSOCancellationCmd(CANCEL);ReversingSpendLimitCmd();PriceUpdateCmd();AlertCmd(emailForCancelAcceptedSO,pushAlertForAcceptedCancelledSO)"/></field>
            </event-listener>
        </transition>
    </decision>
    

    <decision g="308,392,38,48" name="ProviderAcknowledgementCheckForProblem">
        <handler expr="#{providerVerbalAcknowledgmentCheck}" />
        <transition g="-81,-9" name="true" to="CancellationPenaltyReleaseFundsRequested">
			<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
				<field name="commandList">
					<string value="UpdateLegacyStatusCmd(PROBLEM,CANCELLED);BuyerOutboundNotificationCmd(STATUS_CHANGE);UpdateSOCancellationCmd(CANCEL);SOLoggingCmd(CancelSOWithPenalty);
							ReversingSpendLimitCmd();PriceUpdateCmd();IncreasingSpendLimitCmd();ProviderReleasePaymentCmd();AlertCmd(emailForCancelAcceptedSO,pushAlertForAcceptedCancelledSO);RelayOutboundNotificationCmd(ORDER_CANCELED_BY_CUSTOMER);"/>
				</field>
			</event-listener>
		</transition>
        <transition g="-56,-1" name="false" to="PendingCancel">
			<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
				<field name="commandList">
					<string value="ReversingSpendLimitCmd();UpdateLegacyStatusCmd(PROBLEM,PENDINGCANCEL);UpdateSOCancellationCmd(PENDINGCANCEL);
							SOLoggingCmd(pendingCancelLogging);AlertCmd(emailForPendingCancelSO);UpdatePendingCancelHistoryCmd();PriceUpdateForPndngCnclCmd();IncreasingSpendLimitCmd();"/>
				</field>
			</event-listener>
		</transition>
    </decision>	
    
	<state g="1593,779,89,50" name="PendingCancel">
        <on event="start">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList">
                    <string value="FireEventCmd(PENDINGCANCEL);RemoveFieldsCmd(MainJobCode,ServiceOrderChanges,loopCounter,jmsMessageId,walletMessageId,ledgerPostingFee,ledgerSpendLimitRsrvTransactionId,fundsConfirmedTransactionId,ledgerSpendLimitRsrvAmt,ledgerPostTransactionId,PVKey_Comment);"/>
                </field>
            </event-listener>
        </on>	 	 
	        
		<transition g="650,360;650,459:-182,214" name="UPDATE_BATCH_ORDER" to="LocationChangedCheckInPendingCancel"/>
		<transition g="1450,506:-68,-14" name="UPDATE_ORDER" to="PendingCancel"/> 
		<transition g="1814,837;1691,839:-76,-1" name="PROVIDER_REPORT_PROBLEM" to="Problem">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="DistributeTaskPriceCmd();UpdateLegacyStatusCmd(PENDINGCANCEL,PROBLEM);BuyerOutboundNotificationCmd(STATUS_CHANGE);ClearPendingCancelHistCmd();UpdateProblemTypeCmd();AlertCmd(emailForProviderProblemReport);"/></field>
            </event-listener>
        </transition>

        <transition g="1821,857;1692,859:-75,0" name="BUYER_REPORT_PROBLEM" to="Problem">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="DistributeTaskPriceCmd();UpdateLegacyStatusCmd(PENDINGCANCEL,PROBLEM);BuyerOutboundNotificationCmd(STATUS_CHANGE);ClearPendingCancelHistCmd();UpdateProblemTypeCmd();AlertCmd(emailForBuyerProblemReport);"/></field>
            </event-listener>
        </transition>
        <transition g="1821,857;1692,859:-75,0" name="BUYER_WITHDRAW_REQUEST" to="buyerWithdrawCheck">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="BuyerWithdrawCmd();UpdateSubStatusCmd(PENDING_REVIEW);SOLoggingCmd(withdrawPendingCancel);AlertCmd(emailForPendingCancelWithdraw);"/></field>
            </event-listener>
        </transition>
         <transition g="1821,857;1692,859:-75,0" name="BUYER_AGREE_AMOUNT" to="buyerAgreeCheck">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="BuyerAgreeCmd();"/></field>
            </event-listener>
        </transition>
        <transition g="1821,857;1692,859:-75,0" name="BUYER_DISAGREE_AMOUNT" to="buyerDisagreeCheck">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="BuyerDisagreeCmd();UpdateSubStatusCmd(PENDING_RESPONSE);AlertCmd(emailForPendingCancelSO)"/></field>
            </event-listener>
        </transition>
        <transition g="1821,857;1692,859:-75,0" name="PROVIDER_WITHDRAW_REQUEST" to="providerWithdrawCheck">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="ProviderWithdrawCmd();SOLoggingCmd(withdrawPendingCancel);"/></field>
            </event-listener>
        </transition>
        <transition g="1821,857;1692,859:-75,0" name="PROVIDER_AGREE_AMOUNT" to="CancellationPenaltyReleaseFundsRequested">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="ProviderAgreeCmd();SOLoggingCmd(providerAgreePayment);UpdateLegacyStatusCmd(PENDINGCANCEL,CANCELLED);BuyerCallbackNotificationCmd(CANCEL_ORDER);BuyerOutboundNotificationCmd(STATUS_CHANGE);ProviderReleasePaymentCmd();AlertCmd(pushAlertForAcceptedCancelledSO);RelayOutboundNotificationCmd(ORDER_CANCELED_BY_CUSTOMER);"/></field>
            </event-listener>
        </transition>
        <transition g="1821,857;1692,859:-75,0" name="PROVIDER_DISAGREE_AMOUNT" to="PendingCancel">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="ProviderDisagreeCmd();UpdateSubStatusCmd(PENDING_REVIEW);SOLoggingCmd(providerDisagreePayment);"/></field>
            </event-listener>
        </transition>
	        	        	        	 
	</state>    
	
	<decision name="providerWithdrawCheck">
	<handler expr="#{providerWithdrawCheck}" />
	<transition name="pendingResponse" to="PendingCancel">
	<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
				<field name="commandList"><string value="UpdateSubStatusCmd(PENDING_RESPONSE);"/></field>
			</event-listener>
	</transition>
	<transition name="noSubstatus" to="PendingCancel">
	<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
				<field name="commandList"><string value="UpdateSubStatusCmd(NULL);"/></field>
			</event-listener>
	</transition>	
	</decision>
	
	<decision name="buyerWithdrawCheck">
	<handler expr="#{buyerWithdrawCheck}" />
	<transition name="increase" to="IsAutoFundedForAddFundInPendingCancel">
	<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
				<field name="commandList"><string value=""/></field>
			</event-listener>
	</transition>
	<transition name="decrease" to="PendingCancel">
	<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
				<field name="commandList"><string value="DecreasingSpendLimitCmd();"/></field>
			</event-listener>
	</transition>	
	<transition name="noChangeinPrice" to="PendingCancel">
	    <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
		<field name="commandList"><string value=""/></field>
	    </event-listener>
	</transition>
	</decision>
	
	<decision name="buyerDisagreeCheck">
	<handler expr="#{buyerDisagreeCheck}" />
	<transition name="increase" to="IsAutoFundedForAddFundInPendingCancel">
	<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
				<field name="commandList"><string value="SOLoggingCmd(buyerDisgreePayment);"/></field>
			</event-listener>
	</transition>
	<transition name="decrease" to="PendingCancel">
	<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
				<field name="commandList"><string value="SOLoggingCmd(buyerDisgreePayment);DecreasingSpendLimitCmd();"/></field>
			</event-listener>
	</transition>	
	<transition name="noChangeinPrice" to="PendingCancel">
	    <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
		<field name="commandList"><string value="SOLoggingCmd(buyerDisgreePayment);"/></field>
	    </event-listener>
	</transition>
	</decision>
	
	<decision name="buyerAgreeCheck">
	<handler expr="#{buyerAgreeCheck}" />
	<transition name="increase" to="IsAutoFundedForAddFundToCancel">
	<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
			<field name="commandList"><string value=";SOLoggingCmd(buyerAgreePayment);UpdateLegacyStatusCmd(PENDINGCANCEL,CANCELLED);BuyerCallbackNotificationCmd(CANCEL_ORDER);BuyerOutboundNotificationCmd(STATUS_CHANGE);RelayOutboundNotificationCmd(ORDER_CANCELED_BY_CUSTOMER);"/></field>
		</event-listener>
	</transition>
	<transition name="decrease" to="CancellationPenaltyReleaseFundsRequested">
	<event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
				<field name="commandList"><string value=";SOLoggingCmd(buyerAgreePayment);DecreasingSpendLimitCmd();ProviderReleasePaymentCmd();UpdateLegacyStatusCmd(PENDINGCANCEL,CANCELLED);BuyerCallbackNotificationCmd(CANCEL_ORDER);BuyerOutboundNotificationCmd(STATUS_CHANGE);RelayOutboundNotificationCmd(ORDER_CANCELED_BY_CUSTOMER);"/></field>
			</event-listener>
	</transition>	
	<transition name="noChangeinPrice" to="CancellationPenaltyReleaseFundsRequested">
	    <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
		<field name="commandList"><string value="SOLoggingCmd(buyerAgreePayment);ProviderReleasePaymentCmd();UpdateLegacyStatusCmd(PENDINGCANCEL,CANCELLED);BuyerCallbackNotificationCmd(CANCEL_ORDER);BuyerOutboundNotificationCmd(STATUS_CHANGE);RelayOutboundNotificationCmd(ORDER_CANCELED_BY_CUSTOMER);"/></field>
	    </event-listener>
	</transition>
	</decision> 
	
	 <decision g="308,392,38,48" name="IsAutoFundedForAddFundInPendingCancel">
        <handler expr="#{isAutoFunded}" />
        <transition g="-53,-11" name="true" to="PendingCancel">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="IncreaseSpendingCmd();AlertCmd(emailForAddFunds)"/></field>
            </event-listener>
        </transition>
        <transition g="-8,-11" name="false" to="PendingCancel">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="CheckAvailableBalanceForIncreaseCmd();IncreaseSpendingCmd();AlertCmd(emailForAddFunds)"/></field>
            </event-listener>
        </transition>
    </decision>
    
    <decision g="308,392,38,48" name="IsAutoFundedForAddFundToCancel">
        <handler expr="#{isAutoFunded}" />
        <transition g="-53,-11" name="true" to="CancellationPenaltyReleaseFundsRequested">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="IncreaseSpendingCmd();ProviderReleasePaymentCmd();AlertCmd(emailForAddFunds);"/></field>
            </event-listener>
        </transition>
        <transition g="-8,-11" name="false" to="CancellationPenaltyReleaseFundsRequested">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="CheckAvailableBalanceForIncreaseCmd();IncreaseSpendingCmd();ProviderReleasePaymentCmd();AlertCmd(emailForAddFunds);"/></field>
            </event-listener>
        </transition>
    </decision>
    
    
    
	  <decision name="LocationChangedCheckInPendingCancel">
        <handler expr="#{locationChangedCheck}" />
        <transition name="true" to="TaskChangedCheckInPendingCancel">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SONoteCommand(UpdateLocation);AlertCmd(changeOfLocation);"/></field>
            </event-listener>
        </transition>
        <transition name="false" to="TaskChangedCheckInPendingCancel"/>
    </decision>
    
    <decision name="TaskChangedCheckInPendingCancel">
        <handler expr="#{scopeChangedCheck}" />
        <transition name="true" to="OrderSpendLimitChangeCheckInPendingCancel">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="AlertCmd(changeOfScope);SOLoggingCmd(pendingCancelScopeChangeLogging);ClearPendingCancelHistCmd();"/></field>
            </event-listener>
        </transition>
        <transition name="false" to="PendingCancel"/>
    </decision>

    <decision g="308,392,38,48" name="OrderSpendLimitChangeCheckInPendingCancel">
        <handler expr="#{spendLimitChanged}" />
        <transition g="-53,-11" name="increase" to="IsAutoFundedForIncreaseInPendingCancel">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SOLoggingCmd(spendLimitUpdateLogging);"/></field>
            </event-listener>
        </transition>
        <transition g="-8,-11" name="decrease" to="Problem">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="DecreaseSpendingCmd();SOLoggingCmd(spendLimitUpdateLogging);UpdateLegacyStatusCmd(PENDINGCANCEL,PROBLEM);UpdateSubStatusCmd(SCOPE_CHANGE);BuyerOutboundNotificationCmd(STATUS_CHANGE);"/></field>
            </event-listener>
        </transition>
        <transition g="-53,-35" name="noChange" to="Problem">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="UpdateLegacyStatusCmd(PENDINGCANCEL,PROBLEM);UpdateSubStatusCmd(SCOPE_CHANGE);BuyerOutboundNotificationCmd(STATUS_CHANGE);"/></field>
            </event-listener> 
            </transition>       
    </decision>

    <decision g="308,392,38,48" name="IsAutoFundedForIncreaseInPendingCancel">
        <handler expr="#{isAutoFunded}" />
        <transition g="-53,-11" name="true" to="Problem">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="IncreaseSpendingCmd();UpdateLegacyStatusCmd(PENDINGCANCEL,PROBLEM);UpdateSubStatusCmd(SCOPE_CHANGE);BuyerOutboundNotificationCmd(STATUS_CHANGE);"/></field>
            </event-listener>
        </transition>
        <transition g="-8,-11" name="false" to="Problem"/>
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="UpdateLegacyStatusCmd(PENDINGCANCEL,PROBLEM);UpdateSubStatusCmd(SCOPE_CHANGE);BuyerOutboundNotificationCmd(STATUS_CHANGE);"/></field>
            </event-listener>            
    </decision>	
		
	  <decision name="LocationChangedCheckInProblem">
        <handler expr="#{locationChangedCheck}" />
        <transition name="true" to="TaskChangedCheckInProblem">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SONoteCommand(UpdateLocation);AlertCmd(changeOfLocation);"/></field>
            </event-listener>
        </transition>
        <transition name="false" to="TaskChangedCheckInProblem"/>
    </decision>
    
    <decision name="TaskChangedCheckInProblem">
        <handler expr="#{scopeChangedCheck}" />
        <transition name="true" to="OrderSpendLimitChangeCheckInProblem">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="AlertCmd(changeOfScope);SOLoggingCmd(problemScopeChangeLogging);"/></field>
            </event-listener>
        </transition>
        <transition name="false" to="Problem"/>
    </decision>

    <decision g="308,392,38,48" name="OrderSpendLimitChangeCheckInProblem">
        <handler expr="#{spendLimitChanged}" />
        <transition g="-53,-11" name="increase" to="IsAutoFundedForIncreaseInProblem">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="SOLoggingCmd(spendLimitUpdateLogging);"/></field>
            </event-listener>
        </transition>
        <transition g="-8,-11" name="decrease" to="Problem">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="DecreaseSpendingCmd();SOLoggingCmd(spendLimitUpdateLogging);"/></field>
            </event-listener>
        </transition>
        <transition g="-53,-35" name="noChange" to="Problem"/>
    </decision>

    <decision g="308,392,38,48" name="IsAutoFundedForIncreaseInProblem">
        <handler expr="#{isAutoFunded}" />
        <transition g="-53,-11" name="true" to="Problem">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="IncreaseSpendingCmd();"/></field>
            </event-listener>
        </transition>
        <transition g="-8,-11" name="false" to="Problem"/>
    </decision>

    <decision g="1595,622,48,48" name="FromProblemToActivateCheck">
        <handler expr="#{serviceDateTimeReachedCheck}" />
        <transition g="-25,0" name="true" to="Active">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="UpdateLegacyStatusCmd(PROBLEM,ACTIVE);BuyerOutboundNotificationCmd(STATUS_CHANGE);"/></field>
            </event-listener>
        </transition>
        <transition g="1,-4" name="false" to="Accepted">
            <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
                <field name="commandList"><string value="UpdateLegacyStatusCmd(PROBLEM,ACCEPTED);BuyerOutboundNotificationCmd(STATUS_CHANGE);"/></field>
            </event-listener>
        </transition>
    </decision>

    <end g="2021,946,92,52" name="Closed">
	    <on event="start">
	        <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
	            <field name="commandList">
	                <string value="FireEventCmd(CLOSED)"/>
	            </field>
	        </event-listener>
	    </on>
    </end>

    <end g="739,321,92,52" name="Voided">
	    <on event="start">
	        <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
	            <field name="commandList">
	                <string value="FireEventCmd(VOIDED)"/>
	            </field>
	        </event-listener>
	    </on>
    </end>

    <end g="1817,295,92,52" name="Cancelled">
	    <on event="start">
	        <event-listener class="com.servicelive.orderfulfillment.jbpm.jBPMSOCommandRunnerProxy">
	            <field name="commandList">
	                <string value="FireEventCmd(CANCELLED)"/>
	            </field>
	        </event-listener>
	    </on>
    </end>

</process>